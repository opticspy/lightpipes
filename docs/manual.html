<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>6. Manual. &mdash; LightPipes for Python 2.1.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=786ba454"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7. Examples." href="examples.html" />
    <link rel="prev" title="5. User defined functions." href="UserDefinedFunctions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            LightPipes for Python
              <img src="_static/front.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.1.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction.</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">2. Installation.</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">3. Support.</a></li>
<li class="toctree-l1"><a class="reference internal" href="command-reference.html">4. Command Reference.</a></li>
<li class="toctree-l1"><a class="reference internal" href="UserDefinedFunctions.html">5. User defined functions.</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">6. Manual.</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#first-steps">6.1. First steps.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#starting-the-calculations">6.1.1. Starting the calculations.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-dimensions-of-structures">6.1.2. The dimensions of structures.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#apertures-and-screens">6.1.3. Apertures and screens.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#graphing-and-visualisation">6.1.4. Graphing and visualisation.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#free-space-propagation">6.2. Free space propagation.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fft-propagation-spectral-method">6.2.1. FFT propagation (spectral method).</a></li>
<li class="toctree-l3"><a class="reference internal" href="#direct-integration-as-a-convolution-fft-approach">6.2.2. Direct integration as a convolution: FFT approach.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#direct-integration">6.2.3. Direct integration.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#finite-difference-method">6.2.4. Finite difference method.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#splitting-and-mixing-beams">6.3. Splitting and mixing beams.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interpolation">6.4. Interpolation.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#phase-and-intensity-filters">6.5. Phase and intensity filters.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#zernike-polynomials">6.6. Zernike polynomials.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spherical-coordinates">6.7. Spherical coordinates.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#user-defined-phase-and-intensity-filters">6.8. User defined phase and intensity filters.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#random-filters">6.9. Random filters.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fft-and-spatial-filters">6.10. FFT and spatial filters.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#laser-amplifier">6.11. Laser amplifier.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#diagnostics">6.12. Diagnostics.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#strehl-ratio">6.12.1. Strehl ratio.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#beam-power">6.12.2. Beam power.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#field-normalization">6.12.3. Field normalization.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#centroid">6.12.4. Centroid.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#beam-width">6.12.5. Beam width.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#d4-sigma">6.12.5.1. <span class="math notranslate nohighlight">\(D4\sigma\)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#references">6.13. References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">7. Examples.</a></li>
<li class="toctree-l1"><a class="reference internal" href="computerprac.html">8. Computer practical.</a></li>
<li class="toctree-l1"><a class="reference internal" href="Diaprojector.html">9. Diaprojector (In Dutch).</a></li>
</ul>

    <a href="genindex.html">Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">LightPipes for Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">6. </span>Manual.</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/manual.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="manual">
<h1><span class="section-number">6. </span>Manual.<a class="headerlink" href="#manual" title="Link to this heading"></a></h1>
<section id="first-steps">
<h2><span class="section-number">6.1. </span>First steps.<a class="headerlink" href="#first-steps" title="Link to this heading"></a></h2>
<section id="starting-the-calculations">
<h3><span class="section-number">6.1.1. </span>Starting the calculations.<a class="headerlink" href="#starting-the-calculations" title="Link to this heading"></a></h3>
<p>All the calculations must start with the <a class="reference internal" href="command-reference.html#LightPipes.Begin" title="LightPipes.Begin"><code class="xref py py-func docutils literal notranslate"><span class="pre">Begin</span></code></a> command.
This command defines the size of the square grid, the grid dimension and the wave
length of the field.Before any LightPipes commands the LightPipes package
must be imported in your Python script. It is very convenient to use units.
Units are included in the LightPipes package.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt;<span class="w"> </span>from<span class="w"> </span>LightPipes<span class="w"> </span>import<span class="w"> </span>*
&gt;&gt;&gt;<span class="w"> </span><span class="nv">GridSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>*mm
&gt;&gt;&gt;<span class="w"> </span><span class="nv">GridDimension</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
&gt;&gt;&gt;<span class="w"> </span><span class="nv">lambda_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span>*nm<span class="w"> </span><span class="c1">#lambda_ is used because lambda is a Python build-in function.</span>
&gt;&gt;&gt;<span class="w"> </span><span class="nv">Field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Begin<span class="o">(</span>GridSize,<span class="w"> </span>lambda_,<span class="w"> </span>GridDimension<span class="o">)</span>
&gt;&gt;&gt;<span class="w"> </span>print<span class="o">(</span>Field.field<span class="o">)</span>
<span class="o">[[</span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="o">]</span>
<span class="w"> </span><span class="o">[</span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="o">]</span>
<span class="w"> </span><span class="o">[</span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="o">]</span>
<span class="w"> </span><span class="o">[</span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="o">]</span>
<span class="w"> </span><span class="o">[</span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="w"> </span><span class="m">1</span>.+0.j<span class="o">]]</span>
</pre></div>
</div>
<p><em>The use of Begin to define a uniform field with intensity 1 and phase 0.</em></p>
<p>(<a class="reference download internal" download="" href="_downloads/54dbcd11ac000826024941a4b489ac78/Begin.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/b444f4d261dea86b16ef001ce3e1b765/Begin.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/3d95ed22fa70b6d17c3ec6f97debc176/Begin.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/dd89fe73fb43d0cad5f9bba697b3a501/Begin.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/Begin.png" class="plot-directive" src="_images/Begin.png" />
</figure>
<p>A two dimensional array will be defined containing the complex numbers with
the real and imaginary parts equal to one and zero respectively.</p>
</section>
<section id="the-dimensions-of-structures">
<h3><span class="section-number">6.1.2. </span>The dimensions of structures.<a class="headerlink" href="#the-dimensions-of-structures" title="Link to this heading"></a></h3>
<p>The field structures in LightPipes are two dimensional arrays of complex numbers. For example a grid with 256x256 points asks about 1Mb of memory. 512x512 points ask more then 4Mb and 1024x1024 16Mb. Some commands, however need more memory because internal arrays are necessary. Grids up to 2000 x 2000 points are possible with common PC’s and laptops.</p>
</section>
<section id="apertures-and-screens">
<h3><span class="section-number">6.1.3. </span>Apertures and screens.<a class="headerlink" href="#apertures-and-screens" title="Link to this heading"></a></h3>
<p>The simplest component to model is an aperture.
There are three different types of apertures:</p>
<ol class="arabic simple">
<li><p>The circular aperture: <em>CircAperture(R, xs, ys, Field)</em></p></li>
<li><p>The rectangular aperture: <em>RectAperture(wx, wy, xs, ys, phi, Field)</em></p></li>
<li><p>The Gaussian diaphragm: <em>GaussAperture(R, xs, ys, T, Field)</em></p></li>
</ol>
<p>Where R=radius, xs and ys are the shift in x and y direction respectively,
phi is a rotation and T is the centre transmission of the Gaussian aperture.
In addition, there are three commands describing screens:
<a class="reference internal" href="command-reference.html#LightPipes.CircScreen" title="LightPipes.CircScreen"><code class="xref py py-func docutils literal notranslate"><span class="pre">CircScreen</span></code></a> (inversion of the circular aperture),
<a class="reference internal" href="command-reference.html#LightPipes.RectScreen" title="LightPipes.RectScreen"><code class="xref py py-func docutils literal notranslate"><span class="pre">RectScreen</span></code></a>, (inversion of the rectangular aperture)
and <a class="reference internal" href="command-reference.html#LightPipes.GaussScreen" title="LightPipes.GaussScreen"><code class="xref py py-func docutils literal notranslate"><span class="pre">GaussScreen</span></code></a> (inversion of the gauss aperture).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">GridSize</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">mm</span>
<span class="n">GridDimension</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">lambda_</span> <span class="o">=</span> <span class="mi">500</span><span class="o">*</span><span class="n">nm</span> <span class="c1">#lambda_ is used because lambda is a Python build-in function.</span>

<span class="n">R</span><span class="o">=</span><span class="mf">2.5</span><span class="o">*</span><span class="n">mm</span> <span class="c1">#Radius of the aperture</span>
<span class="n">xs</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span> <span class="n">ys</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">mm</span><span class="c1">#shift of the aperture</span>

<span class="n">Field</span> <span class="o">=</span> <span class="n">Begin</span><span class="p">(</span><span class="n">GridSize</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">,</span> <span class="n">GridDimension</span><span class="p">)</span>
<span class="n">Field</span><span class="o">=</span><span class="n">CircAperture</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">I</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/490b8042abe6848d753795ddfc469d25/AperturesandScreens1.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/aa00ebb6d9438133c9b15a0e4b4b1ec9/AperturesandScreens1.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/ed26e3a387948a558c8cd1c23edc8aa0/AperturesandScreens1.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/52c8d6c3500c49bd75d6a23d9d347b43/AperturesandScreens1.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/AperturesandScreens1.png" class="plot-directive" src="_images/AperturesandScreens1.png" />
</figure>
<p><em>Fig. 1. Example of the application of a circular aperture.</em></p>
<p>All kinds of combinations of circular, rectangular and Gaussian apertures
and screens can be made:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">GridSize</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">mm</span>
<span class="n">GridDimension</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">lambda_</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">*</span><span class="n">nm</span> <span class="c1">#lambda_ is used because lambda is a Python build-in function.</span>

<span class="n">R</span><span class="o">=</span><span class="mf">2.5</span><span class="o">*</span><span class="n">mm</span> <span class="c1">#Radius of the aperture</span>
<span class="n">xs</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span> <span class="n">ys</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">mm</span><span class="c1">#shift of the aperture</span>

<span class="n">Field</span> <span class="o">=</span> <span class="n">Begin</span><span class="p">(</span><span class="n">GridSize</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">,</span> <span class="n">GridDimension</span><span class="p">)</span>
<span class="n">Field</span><span class="o">=</span><span class="n">CircScreen</span><span class="p">(</span><span class="mf">0.7</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mi">1</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mf">1.5</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span><span class="o">=</span><span class="n">RectScreen</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mi">1</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="o">-</span><span class="mf">0.002</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span><span class="o">=</span><span class="n">RectScreen</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mf">3.5</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mf">2.5</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span><span class="o">=</span><span class="n">GaussAperture</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">I</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/3bdcb9cde889e4bef29e32100fc352fb/AperturesandScreens2.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/8326c81b747e66287e6dc19e30889b95/AperturesandScreens2.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/fbdeec1409bb35dccb9b14872938b625/AperturesandScreens2.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/ae4f80815e49e0eb62afac867cb53e20/AperturesandScreens2.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/AperturesandScreens2.png" class="plot-directive" src="_images/AperturesandScreens2.png" />
</figure>
<p><em>Fig. 2. The use of screens and apertures.</em></p>
</section>
<section id="graphing-and-visualisation">
<h3><span class="section-number">6.1.4. </span>Graphing and visualisation.<a class="headerlink" href="#graphing-and-visualisation" title="Link to this heading"></a></h3>
<p>In figure 1 and 2 the intensity of the field is calculated after aperturing
‘Field’ with the <a class="reference internal" href="command-reference.html#LightPipes.Intensity" title="LightPipes.Intensity"><code class="xref py py-func docutils literal notranslate"><span class="pre">Intensity</span></code></a> command using option 0,
which means that no normalization is applied. Alternatives are option 1:
normalization to 1 and option 2: normalization to 255 for displaying
gray-values (not often needed). Use has been made of the package
“matplotlib” which can be installed by typing at the python prompt:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pip</span> <span class="n">install</span> <span class="n">matplotlib</span>
</pre></div>
</div>
<p>With the command <a class="reference internal" href="command-reference.html#LightPipes.Interpol" title="LightPipes.Interpol"><code class="xref py py-func docutils literal notranslate"><span class="pre">Interpol</span></code></a> you can reduce the
grid dimension of the field speeding up subsequent plotting considerably,
especially when dealing with 3d surface plots. This is illustrated in
figure 3. In figure 3 we also plotted the cross section of the beam
in a two dimensional XY plot. For this we have to define an integer,
i, ranging from 1 to the grid dimension. This integer must be used
to define the element of the (square) array, I, which is used for
the vertical axis of the XY plot. Use has been made of the “numpy”
package which can be installed by typing at the python prompt:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pip</span> <span class="n">install</span> <span class="n">numpy</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">GridSize</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">mm</span>
<span class="n">GridDimension</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">lambda_</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">*</span><span class="n">nm</span> <span class="c1">#lambda_ is used because lambda is a Python build-in function.</span>

<span class="n">R</span><span class="o">=</span><span class="mf">2.5</span><span class="o">*</span><span class="n">mm</span>
<span class="n">xs</span><span class="o">=</span><span class="mi">0</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span> <span class="n">ys</span><span class="o">=</span><span class="mi">0</span><span class="o">*</span><span class="n">mm</span>
<span class="n">T</span><span class="o">=</span><span class="mf">0.8</span>

<span class="n">Field</span> <span class="o">=</span> <span class="n">Begin</span><span class="p">(</span><span class="n">GridSize</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">,</span> <span class="n">GridDimension</span><span class="p">)</span>
<span class="n">Field</span><span class="o">=</span><span class="n">GaussAperture</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">NewGridDimension</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">GridDimension</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Field</span><span class="o">=</span><span class="n">Interpol</span><span class="p">(</span><span class="n">GridSize</span><span class="p">,</span><span class="n">NewGridDimension</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">I</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">I</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>

<span class="c1">#plot cross section:</span>
<span class="n">x</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NewGridDimension</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="n">GridSize</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">GridSize</span><span class="o">/</span><span class="n">NewGridDimension</span><span class="p">)</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">I</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">NewGridDimension</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x [mm]&#39;</span><span class="p">);</span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity [a.u.]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/ecbeece86c29aef06dedc451aab4d4d1/plotresults.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/190a85ea1f23137a324313ff6be583ee/plotresults_00_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/78df80fc81e044aba767979546adb07b/plotresults_00_00.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/1329656b039bc8544c1a4e6070ff1149/plotresults_00_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/plotresults_00_00.png" class="plot-directive" src="_images/plotresults_00_00.png" />
</figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#3d plot:</span>
<span class="n">X</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">NewGridDimension</span><span class="p">)</span>
<span class="n">Y</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">NewGridDimension</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span> 
<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span><span class="n">I</span><span class="p">,</span>
                <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Intensity [a.u.]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/2503d0ee44162e0b9f35a441b5bc4446/plotresults_01_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/52ac1a1313ce4bc40382e8f6ce721a24/plotresults_01_00.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/e19c2a23a9c8e6577823329b12183124/plotresults_01_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/plotresults_01_00.png" class="plot-directive" src="_images/plotresults_01_00.png" />
</figure>
<p><em>Fig. 3. The use of XY-plots and surface plots to present your simulation results. Note the usage of Interpol to reduce the grid dimension for a faster surface plot.</em></p>
<p>For more see: <a class="reference external" href="https://matplotlib.org">https://matplotlib.org</a></p>
</section>
</section>
<section id="free-space-propagation">
<span id="index-0"></span><h2><span class="section-number">6.2. </span>Free space propagation.<a class="headerlink" href="#free-space-propagation" title="Link to this heading"></a></h2>
<p>There are four different possibilities for modelling the light propagation
in LightPipes.</p>
<section id="fft-propagation-spectral-method">
<h3><span class="section-number">6.2.1. </span>FFT propagation (spectral method).<a class="headerlink" href="#fft-propagation-spectral-method" title="Link to this heading"></a></h3>
<p>Let us consider the wave function <span class="math notranslate nohighlight">\(U\)</span> in two planes:
<span class="math notranslate nohighlight">\(U(x,y,0\)</span>) and <span class="math notranslate nohighlight">\(U(x,y,z)\)</span>. Suppose then that
<span class="math notranslate nohighlight">\(U(x,y,z)\)</span> is the result of propagation of
<span class="math notranslate nohighlight">\(U(x,y,0)\)</span> to the distance <span class="math notranslate nohighlight">\(z\)</span> ,
with the Fourier transforms of these two (initial and propagated )
wave functions
given by <span class="math notranslate nohighlight">\(A(\alpha,\beta,0)\)</span> and <span class="math notranslate nohighlight">\(A(\alpha,\beta,z)\)</span>
correspondingly.
In the Fresnel approximation, the Fourier transform of the diffracted wave
function is related to the Fourier transform of the initial function
via the frequency transfer characteristic of the free space
<span class="math notranslate nohighlight">\(H( \alpha,\beta,z)\)</span> , given by <a class="footnote-reference brackets" href="#f1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#f2" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> :</p>
<div class="math notranslate nohighlight" id="equation-1">
<span class="eqno">(1)<a class="headerlink" href="#equation-1" title="Link to this equation"></a></span>\[H=\frac{A(\alpha, \beta, z)}{A(\alpha, \beta, 0)}=\exp \big\{ {{-ikz(1-\alpha^2-\beta^2)}^{1/2}}\big\}\]</div>
<p>where:</p>
<div class="math notranslate nohighlight" id="equation-2">
<span class="eqno">(2)<a class="headerlink" href="#equation-2" title="Link to this equation"></a></span>\[A(\alpha, \beta,0)= \int \int_{ -\infty} ^{ \infty}  U(x,y,0)exp{\{-ikz(\alpha x+\beta y)}\}dxdy\]</div>
<div class="math notranslate nohighlight" id="equation-3">
<span class="eqno">(3)<a class="headerlink" href="#equation-3" title="Link to this equation"></a></span>\[A(\alpha, \beta,z)= \int \int_{ -\infty} ^{ \infty}  U(x,y,z)exp{\{-ikz(\alpha x+\beta y)}\}dxdy\]</div>
<p>Expressions <a class="reference internal" href="#equation-1">(1)</a>, <a class="reference internal" href="#equation-2">(2)</a>, and <a class="reference internal" href="#equation-3">(3)</a> provide a symmetrical relation
between the initial and diffracted wave
functions in the Fresnel approximation. Applied in the order
<a class="reference internal" href="#equation-2">(2)</a> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <a class="reference internal" href="#equation-1">(1)</a> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <a class="reference internal" href="#equation-3">(3)</a>
they result in the diffracted wave function, while being applied in the
reversed order they allow for reconstruction of
the initial wave function from the result of diffraction. We shall denote
the forward and the reversed propagation operations defined by expressions
<a class="reference internal" href="#equation-1">(1)</a>, <a class="reference internal" href="#equation-2">(2)</a> and <a class="reference internal" href="#equation-3">(3)</a> with operators
<span class="math notranslate nohighlight">\(L^+\)</span> and <span class="math notranslate nohighlight">\(L^-\)</span> respectively. The described algorithm can be
implemented numerically using Fast Fourier Transform (FFT) <a class="footnote-reference brackets" href="#f2" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#f3" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> on
a finite rectangular grid with periodic border conditions. It results in a model
of beam propagation inside a rectangular wave guide with reflective walls.
To approximate a free-space propagation, wide empty guard bands have to be
formed around the wave function defined on a grid. To eliminate the influence
of the finite rectangular data window, Gaussian amplitude windowing in
the frequency domain should be applied, see <a class="footnote-reference brackets" href="#f2" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#f3" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> for
extensive analysis of these computational aspects. The simplest and fastest
LightPipes command for propagation is <a class="reference internal" href="command-reference.html#LightPipes.Forvard" title="LightPipes.Forvard"><code class="xref py py-func docutils literal notranslate"><span class="pre">Forvard</span></code></a>. (The ‘v’ is a type error made on purpose!)
It implements the spectral method described by <a class="footnote-reference brackets" href="#f1" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#f2" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#f3" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> . The syntax is simple,
for example if you want to filter your field through a 1cm aperture and then
propagate the beam 1m forward, you type the following commands:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">Field</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">um</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">CircAperture</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">Forvard</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>

<span class="n">x</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="o">/</span><span class="mi">256</span><span class="p">)</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">);</span> <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">I</span><span class="p">[</span><span class="mi">128</span><span class="p">]);</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [mm]&#39;</span><span class="p">);</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity [a.u.]&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/320658b56bd43a3d1ecf6182973f3be4/Forvard.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/c0a5ed380834c744c64d7283f964ab32/Forvard.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/2466103bcdcde71fd619e8abf334450c/Forvard.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/f76b12977b6dab234fc52890bf4e444b/Forvard.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/Forvard.png" class="plot-directive" src="_images/Forvard.png" />
</figure>
<p><em>Fig. 4. The result of the propagation: density and cross section intensity plots.</em></p>
<p>We see the diffraction effects, the intensity distribution is not uniform anymore.
The algorithm is very fast
in comparison with direct calculation of diffraction integrals. Features to be taken into account:
The algorithm realises a model of light beam propagation inside a square wave guide with
reflecting walls positioned at the grid edges. To approximate a
free space propagation, the intensity near
the walls must be negligible small. Thus the grid edges must be far enough from the propagating beam.
Neglecting these conditions will cause interference of the propagating beam with waves reflected
from the wave guide walls.
As a consequence of the previous feature, we must be extremely careful propagating the plane wave
to a distance comparable with <span class="math notranslate nohighlight">\(D^2/\lambda\)</span> where <span class="math notranslate nohighlight">\(D\)</span> is the diameter
(or a characteristic size) of
the beam, and <span class="math notranslate nohighlight">\(\lambda\)</span> is the wavelength. To propagate the beam to
the far field (or just far enough)
we have to choose the size of our grid much larger than the beam itself,
in other words we define the field in a grid filled mainly with zeros.
The grid must be even larger when the beam is aberrated because the divergent
beams reach the region border sooner.</p>
<p>Due to these two reasons the commands:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">Field</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">um</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">RectAperture</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">Forvard</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>

<span class="n">x</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="o">/</span><span class="mi">256</span><span class="p">)</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">);</span> <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">I</span><span class="p">[</span><span class="mi">128</span><span class="p">]);</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [mm]&#39;</span><span class="p">);</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity [a.u.]&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/8aeec7fe58320b1b50742cda071e36d3/Forvard2.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/3ba6d3036a2c8e7502062b8dc056e27a/Forvard2.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/d82b53bb08b3abb4e33f556d8516329f/Forvard2.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/653f7b9fb2ad9318a8265875eb112270/Forvard2.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/Forvard2.png" class="plot-directive" src="_images/Forvard2.png" />
</figure>
<p>make no sense. The cross section of the beam
(argument of <a class="reference internal" href="command-reference.html#LightPipes.RectAperture" title="LightPipes.RectAperture"><code class="xref py py-func docutils literal notranslate"><span class="pre">RectAperture</span></code></a>)
equals to the section of the grid (the first argument of <a class="reference internal" href="command-reference.html#LightPipes.Begin" title="LightPipes.Begin"><code class="xref py py-func docutils literal notranslate"><span class="pre">Begin</span></code></a>), so we have
a model of light propagation in a wave guide but not in a free space. One has to put:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">Field</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="mi">40</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">um</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">RectAperture</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">Forvard</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>

<span class="n">x</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="mi">40</span><span class="o">*</span><span class="n">mm</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">40</span><span class="o">*</span><span class="n">mm</span><span class="o">/</span><span class="mi">256</span><span class="p">)</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">);</span> <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">I</span><span class="p">[</span><span class="mi">128</span><span class="p">]);</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [mm]&#39;</span><span class="p">);</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity [a.u.]&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/68dbf2d78120ae28be93b5ef42985205/Forvard3.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/a8222575097605fc6b4c5b52591d21b6/Forvard3.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/4eff7a069d9aa24e52f757861e507d82/Forvard3.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/df553e836f2ba9a4690fca5b76ebe132/Forvard3.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/Forvard3.png" class="plot-directive" src="_images/Forvard3.png" />
</figure>
<p>for propagation in the near field, and may be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">Field</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="mi">400</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">um</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">RectAperture</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">Forvard</span><span class="p">(</span><span class="mi">500</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>

<span class="n">x</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">512</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="o">/</span><span class="mi">512</span><span class="p">)</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">);</span> <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">I</span><span class="p">[</span><span class="mi">256</span><span class="p">]);</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [mm]&#39;</span><span class="p">);</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity [a.u.]&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/4eba996620eea90d33d681fd9b774455/Forvard4.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/c744aa569935fd43ae74be56f1c721d4/Forvard4.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/035e8af8c0540ef9239b67aa6f8dcc3f/Forvard4.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/1ba3e5c2aaabaa54774559af55d494cc/Forvard4.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/Forvard4.png" class="plot-directive" src="_images/Forvard4.png" />
</figure>
<p>for far field propagation.
If we compare the result of the previous example with the result of:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">Field</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">um</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">RectAperture</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">Forvard</span><span class="p">(</span><span class="mi">500</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>

<span class="n">x</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">512</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="o">/</span><span class="mi">512</span><span class="p">)</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">);</span> <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">I</span><span class="p">[</span><span class="mi">256</span><span class="p">]);</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [mm]&#39;</span><span class="p">);</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity [a.u.]&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/2e7b5bc3f3f14a111dab37300375fcc9/Forvard5.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/8ce6b3bbab422bab462d51223f6e61c9/Forvard5.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/420ef7d92aeaff4c92e1118e3d206859/Forvard5.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/7e74f8c5c0a93e440c02a259a069b0ca/Forvard5.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/Forvard5.png" class="plot-directive" src="_images/Forvard5.png" />
</figure>
<p>we’ll see the difference.</p>
<p>We have discussed briefly the drawbacks of the FFT algorithm. The good thing is
that it is very fast, works pretty well if properly used, is simple in implementation
and does not require the allocation of extra memory. In LightPipes a negative argument
may be supplied to <a class="reference internal" href="command-reference.html#LightPipes.Forvard" title="LightPipes.Forvard"><code class="xref py py-func docutils literal notranslate"><span class="pre">Forvard</span></code></a>. It means that the program will
perform “propagation back”
or in other words it will reconstruct the initial field from the one diffracted. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">Field</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">um</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">CircAperture</span><span class="p">(</span><span class="mi">25</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">I0</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">Forvard</span><span class="p">(</span><span class="mi">30</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">I1</span> <span class="o">=</span> <span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">Forvard</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">I2</span> <span class="o">=</span> <span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>

<span class="n">x</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">512</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span><span class="o">/</span><span class="mi">512</span><span class="p">)</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I0</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">);</span> <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Initial field&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Propagated to the near field&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I2</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">);</span> <span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Propagated back&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/a4782258652f4ad97f185bf655a69104/Forvard6.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/077c7cadf7de0c58779902d1d6ff189a/Forvard6.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/ecfac4bf55c411961bc216f4fc78a03e/Forvard6.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/089d13c0fc4dc38e28bae9da6de92712/Forvard6.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/Forvard6.png" class="plot-directive" src="_images/Forvard6.png" />
</figure>
<p><em>Fig. 5. The initial filed, the field propagated to the near field and the field propagated back</em></p>
</section>
<section id="direct-integration-as-a-convolution-fft-approach">
<h3><span class="section-number">6.2.2. </span>Direct integration as a convolution: FFT approach.<a class="headerlink" href="#direct-integration-as-a-convolution-fft-approach" title="Link to this heading"></a></h3>
<p>Another possibility of a fast computer implementation of the operator <span class="math notranslate nohighlight">\(L^+\)</span> is free
from many of the drawbacks of the described spectral algorithm. The operator <span class="math notranslate nohighlight">\(L^+\)</span> may be
numerically implemented with direct summation of the Fresnel-Kirchoff diffraction integral:</p>
<div class="math notranslate nohighlight" id="equation-4">
<span class="eqno">(4)<a class="headerlink" href="#equation-4" title="Link to this equation"></a></span>\[U(x_1,y_1,z)=\frac{k}{2\pi iz} \int \int U(x,y,0)\exp \big\{ik\frac{(x-x_1)^2+(y-y_1)^2}{2 z}\big\}dxdy\]</div>
<p>with functions <span class="math notranslate nohighlight">\(U(x,y,0)\)</span> and <span class="math notranslate nohighlight">\(U(x,y,z)\)</span> defined on rectangular grids.
This integral may be converted into a convolution form which can be efficiently computed
using FFT <a class="footnote-reference brackets" href="#f4" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a> , [f#5]_ . This method is free from many drawbacks of the spectral method given by
the sequence <a class="reference internal" href="#equation-3">(3)</a> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <a class="reference internal" href="#equation-2">(2)</a> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <a class="reference internal" href="#equation-4">(4)</a>
although it is still very fast due to its use of FFT for computing of the integral sums.</p>
<p>We’ll explain this using a two-dimensional example, following <a class="footnote-reference brackets" href="#f4" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>, p.100. Let the integral
be defined in a finite interval <span class="math notranslate nohighlight">\(–L/2\cdots L/2\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-5">
<span class="eqno">(5)<a class="headerlink" href="#equation-5" title="Link to this equation"></a></span>\[U(x_1,z)= \sqrt{ \frac{k}{2\pi iz}} \int _{-L/2}^{L/2} U(x,0)\exp \big\{ik\frac{(x-x_1)^2}{2 z}\big\}dx\]</div>
<p>Replacing the functions U(x) and U(x1) with step functions Uj and Um, defined in
the sampling points of the grid with j=0…N, and m=0…N we convert the integral (5.5) to the form:</p>
<div class="math notranslate nohighlight" id="equation-6">
<span class="eqno">(6)<a class="headerlink" href="#equation-6" title="Link to this equation"></a></span>\[U_m= \sqrt{ \frac{k}{2\pi iz}}  \sum_{j=1}^{N-1}U_j \int   _{x_j-0.5}^{x_j+0.5} \exp \big\{ik\frac{(x_m-x)^2}{2 z}\big\}dx + U_0 \int   _{x_0}^{0.5} \exp \big\{ik\frac{(x_m-x)^2}{2 z}\big\}dx + U_N \int   _{x_N-0.5}^{x_N} \exp \big\{ik\frac{(x_m-x)^2}{2 z}\big\}dx\]</div>
<p>Taking the integrals in <a class="reference internal" href="#equation-6">(6)</a> we obtain:</p>
<div class="math notranslate nohighlight" id="equation-7">
<span class="eqno">(7)<a class="headerlink" href="#equation-7" title="Link to this equation"></a></span>\[U_m=  \sum_{j=1}^{N-1} U_j K_{mj}+U_0K_{m0}+U_NK_{mN}\]</div>
<p>where: <span class="math notranslate nohighlight">\(K_{m0}\)</span>, <span class="math notranslate nohighlight">\(K_{mj}\)</span> and <span class="math notranslate nohighlight">\(K_{mN}\)</span> are analytical expressed
with the help of Fresnel
integrals, depending only onto the difference of indices. The summations
<span class="math notranslate nohighlight">\(\sum_{j=1}^{N-1} U_j K_{mj}\)</span> can
easily be calculated for all indices m as one convolution with the help of FFT.</p>
<p>The command <a class="reference internal" href="command-reference.html#LightPipes.Fresnel" title="LightPipes.Fresnel"><code class="xref py py-func docutils literal notranslate"><span class="pre">Fresnel</span></code></a> implements this algorithm using the
trapezoidal rule. It is almost as fast
as <a class="reference internal" href="command-reference.html#LightPipes.Forvard" title="LightPipes.Forvard"><code class="xref py py-func docutils literal notranslate"><span class="pre">Forvard</span></code></a> (from 2 to 5 times slower), it uses 8 times more
memory than <a class="reference internal" href="command-reference.html#LightPipes.Forvard" title="LightPipes.Forvard"><code class="xref py py-func docutils literal notranslate"><span class="pre">Forvard</span></code></a> and it allows
for “more honest” calculation of near and far-field diffraction. As it does not require
any protection bands at the edges of the region, the model may be built in a smaller grid,
therefore the resources consumed and time of execution are comparable or even better than that
of <a class="reference internal" href="command-reference.html#LightPipes.Forvard" title="LightPipes.Forvard"><code class="xref py py-func docutils literal notranslate"><span class="pre">Forvard</span></code></a>. <a class="reference internal" href="command-reference.html#LightPipes.Fresnel" title="LightPipes.Fresnel"><code class="xref py py-func docutils literal notranslate"><span class="pre">Fresnel</span></code></a> does not accept a negative propagation distance. When possible <a class="reference internal" href="command-reference.html#LightPipes.Fresnel" title="LightPipes.Fresnel"><code class="xref py py-func docutils literal notranslate"><span class="pre">Fresnel</span></code></a>
has to be used as the main computational engine within LightPipes.</p>
<p><strong>Warning:</strong> <a class="reference internal" href="command-reference.html#LightPipes.Fresnel" title="LightPipes.Fresnel"><code class="xref py py-func docutils literal notranslate"><span class="pre">Fresnel</span></code></a> does not produce valid results if the distance of propagation
is comparable with (or less than) the characteristic size of the aperture
at which the field is diffracted. In this case <a class="reference internal" href="command-reference.html#LightPipes.Forvard" title="LightPipes.Forvard"><code class="xref py py-func docutils literal notranslate"><span class="pre">Forvard</span></code></a> or
<a class="reference internal" href="command-reference.html#LightPipes.Steps" title="LightPipes.Steps"><code class="xref py py-func docutils literal notranslate"><span class="pre">Steps</span></code></a> should be used.</p>
</section>
<section id="direct-integration">
<h3><span class="section-number">6.2.3. </span>Direct integration.<a class="headerlink" href="#direct-integration" title="Link to this heading"></a></h3>
<p>Direct calculation of the Fresnel-Kirchoff integrals is very inefficient
in two-dimensional grids. The number of operations is proportional to
<span class="math notranslate nohighlight">\(N^4\)</span> , where <span class="math notranslate nohighlight">\(N\)</span> is the grid sampling. With direct integration
we do not have any reflection at the grid boundary, so the size of the grid can just match the cross section of field distribution. LightPipes include a program <a class="reference internal" href="command-reference.html#LightPipes.Forward" title="LightPipes.Forward"><code class="xref py py-func docutils literal notranslate"><span class="pre">Forward</span></code></a> realizing direct integration. <a class="reference internal" href="command-reference.html#LightPipes.Forward" title="LightPipes.Forward"><code class="xref py py-func docutils literal notranslate"><span class="pre">Forward</span></code></a> has the following features:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>arbitrary sampling and size of square grid at the input plane.</p></li>
<li><p>arbitrary sampling and size of square grid at the output plane, it means we can propagate the field
from a grid containing for example 52 x 52 points corresponding to 4.9 x4 .9 cm to a grid containing 42 x 42 points and corresponding let’s say 8.75 x 8.75 cm.</p></li>
</ol>
</div></blockquote>
</section>
<section id="finite-difference-method">
<h3><span class="section-number">6.2.4. </span>Finite difference method.<a class="headerlink" href="#finite-difference-method" title="Link to this heading"></a></h3>
<p>It can be shown that the propagation of the field <span class="math notranslate nohighlight">\(U\)</span> in a medium with complex
refractive coefficient <span class="math notranslate nohighlight">\(A\)</span>, is described by the differential equation:</p>
<div class="math notranslate nohighlight" id="equation-8">
<span class="eqno">(8)<a class="headerlink" href="#equation-8" title="Link to this equation"></a></span>\[\frac{\partial^2U}{\partial x^2} + \frac{\partial^2U}{\partial y^2}+2ik \frac{\partial U}{\partial z}  +A(x,y,z)U=0\]</div>
<p>To solve this equation, we re-write it as a system of finite difference equations:</p>
<div class="math notranslate nohighlight" id="equation-9">
<span class="eqno">(9)<a class="headerlink" href="#equation-9" title="Link to this equation"></a></span>\[\frac{U^{k+1}_{i+1,j}-2U^{k+1}_{i,j}+U^{k+1}_{i-1,j}}{\Delta x^2}+\frac{U^{k}_{i,j+1}-2U^{k}_{i,j}+U^{k}_{i,j-1}}{\Delta y^2}+2ik\frac{U^{k+1}_{i,j}-2U^k_{i,j}}{\Delta z}+A^{k+1}_{i,j}U^{k+1}_{i,j}=0\]</div>
<p>Collecting terms we obtain the standard three-diagonal system of linear equations,
the solution of which describes the complex amplitude of the light field in the layer <span class="math notranslate nohighlight">\(z+\Delta z\)</span> as a
function of the field defined in the layer z:</p>
<div class="math notranslate nohighlight" id="equation-10">
<span class="eqno">(10)<a class="headerlink" href="#equation-10" title="Link to this equation"></a></span>\[-a_iU^{k+1}_{i-1,j}+c_iU^{k+1}_{i,j}-b_iU^{k+1}_{i+1,j}=f_i\]</div>
<p>where: (we put <span class="math notranslate nohighlight">\(\Delta x=\Delta y=\Delta\)</span> )</p>
<div class="math notranslate nohighlight" id="equation-11">
<span class="eqno">(11)<a class="headerlink" href="#equation-11" title="Link to this equation"></a></span>\[a_i=b_i=-\frac{1}{\Delta^2}\]</div>
<div class="math notranslate nohighlight" id="equation-12">
<span class="eqno">(12)<a class="headerlink" href="#equation-12" title="Link to this equation"></a></span>\[c_i=A^{k+1}_{i,j}-\frac{2}{\Delta^2}+\frac{2ik}{\Delta z}\]</div>
<div class="math notranslate nohighlight" id="equation-13">
<span class="eqno">(13)<a class="headerlink" href="#equation-13" title="Link to this equation"></a></span>\[f_i=\frac{2ik}{\Delta z}U^k_{i,j}-\frac{U^k_{i,j+1}-2U^k_{i,j}+U^k_{i,j-1}}{\Delta^2}\]</div>
<p>The three-diagonal system of linear equations <a class="reference internal" href="#equation-10">(10)</a> is solved by the standard elimination
(double sweep) method, described for example in <a class="footnote-reference brackets" href="#f1" id="id12" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> . This scheme is absolutely stable
(this variant is explicit with respect to the index <span class="math notranslate nohighlight">\(i\)</span> and implicit with respect to the
index <span class="math notranslate nohighlight">\(j\)</span>). One step of propagation is divided into two sub-steps: the first sub-step
applies the described procedure to all rows of the matrix, the second sub-step changes
the direction of elimination and the procedure is applied to all columns of the matrix.</p>
<p>The main advantage of this approach is the possibility to take into account uniformly
diffraction, absorption (amplification) and refraction. For example, the model of a
waveguide with complex three-dimensional distribution of refraction index and absorption
coefficient (both are defined as real and imaginary components of the (three-dimensional in general)
matrix   <span class="math notranslate nohighlight">\(A^k_{i,j}\)</span>) can be built easily.</p>
<p>It works also much faster than all described previously algorithms on one step of
propagation, though to obtain a good result at a considerable distance, many steps should
be done. As the scheme is absolutely stable (at least for free-space propagation),
there is no stability limitation on the step size in the direction <span class="math notranslate nohighlight">\(z.\)</span>
Large steps cause high-frequency errors, therefore the number of steps should be determined by
trial (increase the number of steps in a probe model till the result stabilizes),
especially for strong variations of refraction and absorption inside the propagation path.</p>
<p>Zero amplitude boundary conditions are commonly used for the described system. This,
again, creates the problem of the wave reflection at the grid boundary. The influence
of these reflections in many cases can be reduced by introducing an additional absorbing
layer in the proximity of the boundary, with the absorption smoothly (to reduce the
reflection at the absorption gradient) increasing towards the boundary.</p>
<p>In LightPipes for Python 2.1.5 the refraction term is not included into the
propagation formulas, instead the phase of the field is modified at each step according to
the distribution of the refractive coefficient. This “zero-order” approximation happened to
be much more stable numerically than the direct inclusion of refraction terms into propagation
formulas. It does not take into account the change of the wavelength in the medium, it does not
model backscattering and reflections back on interfaces between different media. Perhaps there
are other details to be mentioned. The described algorithm is implemented in the <a class="reference internal" href="command-reference.html#LightPipes.Steps" title="LightPipes.Steps"><code class="xref py py-func docutils literal notranslate"><span class="pre">Steps</span></code></a> command.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Focus of a lens.</span>
<span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span><span class="o">*</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">wavelength</span><span class="o">=</span><span class="mf">632.8</span><span class="o">*</span><span class="n">nm</span><span class="p">;</span>
<span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span>
<span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span>
<span class="n">N2</span><span class="o">=</span><span class="mi">50</span><span class="p">;</span>
<span class="n">R</span><span class="o">=</span><span class="mf">1.5</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span>
<span class="n">dz</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span>
<span class="n">f</span><span class="o">=</span><span class="mi">50</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>
<span class="n">n</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.1</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>

<span class="n">Icross</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
<span class="n">X</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">Z</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Z</span><span class="p">)</span>
<span class="n">F</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">N</span><span class="p">);</span>
<span class="n">F</span><span class="o">=</span><span class="n">CircAperture</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>
<span class="n">F</span><span class="o">=</span><span class="n">Lens</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
  <span class="n">F</span><span class="o">=</span><span class="n">Steps</span><span class="p">(</span><span class="n">dz</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>
  <span class="n">I</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>
  <span class="n">Icross</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="n">N</span><span class="p">]</span><span class="o">=</span><span class="n">I</span><span class="p">[</span><span class="n">N2</span><span class="p">][:</span><span class="n">N</span><span class="p">]</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span>
        <span class="n">Icross</span><span class="p">,</span>
        <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/8b3deafefe26d08560ef1b0d882ad5ec/FocLens.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/61cf64ca5ec75426037860365c2c5514/FocLens.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/c2c46f5b05556ae9578cf4abd96468db/FocLens.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/05cf9e88fd778efed44b463299901cb1/FocLens.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/FocLens.png" class="plot-directive" src="_images/FocLens.png" />
</figure>
<p><em>Fig. 6. The use of Steps to calculate the intensity distribution in the focus of a lens.</em></p>
<p>The <a class="reference internal" href="command-reference.html#LightPipes.Steps" title="LightPipes.Steps"><code class="xref py py-func docutils literal notranslate"><span class="pre">Steps</span></code></a> command has a built-in absorption layer along the grid boundaries
(to prevent reflections), occupying 10% of grid from each side. <a class="reference internal" href="command-reference.html#LightPipes.Steps" title="LightPipes.Steps"><code class="xref py py-func docutils literal notranslate"><span class="pre">Steps</span></code></a> is the only command in LightPipes
allowing for modeling of (three-dimensional) waveguide devices.</p>
<p>Like <a class="reference internal" href="command-reference.html#LightPipes.Forvard" title="LightPipes.Forvard"><code class="xref py py-func docutils literal notranslate"><span class="pre">Forvard</span></code></a>, <a class="reference internal" href="command-reference.html#LightPipes.Steps" title="LightPipes.Steps"><code class="xref py py-func docutils literal notranslate"><span class="pre">Steps</span></code></a> can inversely propagate the field, for example the sequence</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">Field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Steps<span class="o">(</span><span class="w"> </span><span class="m">0</span>.1,<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>n,<span class="w"> </span>Field<span class="o">)</span>
<span class="nv">Field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Steps<span class="o">(</span>-0.1,<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>n<span class="w"> </span>,Field<span class="o">)</span>
</pre></div>
</div>
<p>doesn’t change anything in the field distribution. The author has tested this reversibility
also for propagation in absorptive/refractive media, examples will follow.</p>
<p><a class="reference internal" href="command-reference.html#LightPipes.Steps" title="LightPipes.Steps"><code class="xref py py-func docutils literal notranslate"><span class="pre">Steps</span></code></a> implements scalar approximation, it is not applicable for modeling of
waveguide devices in the vector approximation, where two components of the
field should be taken into account.</p>
</section>
</section>
<section id="splitting-and-mixing-beams">
<h2><span class="section-number">6.3. </span>Splitting and mixing beams.<a class="headerlink" href="#splitting-and-mixing-beams" title="Link to this heading"></a></h2>
<p>There are two commands in LightPipes which are useful for modelling of interferometers. With <a class="reference internal" href="command-reference.html#LightPipes.IntAttenuator" title="LightPipes.IntAttenuator"><code class="xref py py-func docutils literal notranslate"><span class="pre">IntAttenuator</span></code></a> we can split the field structure (amplitude division) - The two obtained fields could be processed separately and then mixed again with the routine <a class="reference internal" href="command-reference.html#LightPipes.BeamMix" title="LightPipes.BeamMix"><code class="xref py py-func docutils literal notranslate"><span class="pre">BeamMix</span></code></a>. In this script we have formed two beams each containing one “shifted” hole. After mixing these two beams we have a screen with two holes: a Young’s interferometer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Young&#39;s experiment.</span>
<span class="sd">    Two holes with radii, R, separated by, d, in a screen are illuminated by a plane wave. The interference pattern</span>
<span class="sd">    at a distance, z, behind the screen is calculated.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">wavelength</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">um</span>
<span class="n">size</span><span class="o">=</span><span class="mf">20.0</span><span class="o">*</span><span class="n">mm</span>
<span class="n">N</span><span class="o">=</span><span class="mi">500</span>
<span class="n">z</span><span class="o">=</span><span class="mi">50</span><span class="o">*</span><span class="n">cm</span>
<span class="n">R</span><span class="o">=</span><span class="mf">0.3</span><span class="o">*</span><span class="n">mm</span>
<span class="n">d</span><span class="o">=</span><span class="mf">1.2</span><span class="o">*</span><span class="n">mm</span>

<span class="n">F</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">F1</span><span class="o">=</span><span class="n">CircAperture</span><span class="p">(</span><span class="n">R</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="o">-</span><span class="n">d</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
<span class="n">F2</span><span class="o">=</span><span class="n">CircAperture</span><span class="p">(</span><span class="n">R</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">d</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>    
<span class="n">F</span><span class="o">=</span><span class="n">BeamMix</span><span class="p">(</span><span class="n">F1</span><span class="p">,</span><span class="n">F2</span><span class="p">)</span>
<span class="n">F</span><span class="o">=</span><span class="n">Fresnel</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">I</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>

<span class="n">s1</span> <span class="o">=</span>    <span class="sa">r</span><span class="s1">&#39;LightPipes for Python &#39;</span> <span class="o">+</span> <span class="n">LPversion</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="n">s2</span> <span class="o">=</span>    <span class="sa">r</span><span class="s1">&#39;Young.py&#39;</span><span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>\
        <span class="sa">f</span><span class="s1">&#39;size = </span><span class="si">{</span><span class="n">size</span><span class="o">/</span><span class="n">mm</span><span class="si">:</span><span class="s1">4.2f</span><span class="si">}</span><span class="s1"> mm&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>\
        <span class="sa">f</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">lambda$ = </span><span class="si">{</span><span class="n">wavelength</span><span class="o">/</span><span class="n">um</span><span class="si">:</span><span class="s1">4.2f</span><span class="si">}</span><span class="s1"> $</span><span class="se">\\</span><span class="s1">mu$m&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>\
        <span class="sa">f</span><span class="s1">&#39;N = </span><span class="si">{</span><span class="n">N</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>\
        <span class="sa">f</span><span class="s1">&#39;d = </span><span class="si">{</span><span class="n">d</span><span class="o">/</span><span class="n">mm</span><span class="si">:</span><span class="s1">4.2f</span><span class="si">}</span><span class="s1"> mm distance between the holes&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>\
        <span class="sa">f</span><span class="s1">&#39;R = </span><span class="si">{</span><span class="n">R</span><span class="o">/</span><span class="n">mm</span><span class="si">:</span><span class="s1">4.2f</span><span class="si">}</span><span class="s1"> mm radius of the holes&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>\
        <span class="sa">f</span><span class="s1">&#39;z = </span><span class="si">{</span><span class="n">z</span><span class="o">/</span><span class="n">mm</span><span class="si">:</span><span class="s1">4.2f</span><span class="si">}</span><span class="s1"> mm distance to screen&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>\
        <span class="sa">r</span><span class="s1">&#39;${\copyright}$ Fred van Goor, June 2020&#39;</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">));</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">);</span><span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">);</span><span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">);</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;intensity pattern&#39;</span><span class="p">)</span>


<span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="n">s1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">s2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/258b30836117aa2d3fa2f1ebff54ee5c/Young.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/bdb2315586da2ca355b3ecb6ec54b6c6/Young.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/65bbcf6178be028ad2532f663f244dbb/Young.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/4a71de1ab14450463ea4a7d2e8dec87b/Young.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/Young.png" class="plot-directive" src="_images/Young.png" />
</figure>
<p><em>Fig. 7. Young’s interferometer.</em></p>
<p>Having the model of the interferometer we can “play” with it, moving the pinholes and changing their sizes. The following models the result of the interference of a plane wave diffracted at three round apertures:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">wavelength</span><span class="o">=</span><span class="mi">550</span><span class="o">*</span><span class="n">nm</span>
<span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">mm</span>
<span class="n">N</span><span class="o">=</span><span class="mi">128</span>
<span class="n">R</span><span class="o">=</span><span class="mf">0.12</span><span class="o">*</span><span class="n">mm</span>
<span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">mm</span>
<span class="n">y</span><span class="o">=</span><span class="mf">0.25</span><span class="o">*</span><span class="n">mm</span>
<span class="n">z</span><span class="o">=</span><span class="mi">75</span><span class="o">*</span><span class="n">cm</span>

<span class="n">F</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">F1</span><span class="o">=</span><span class="n">CircAperture</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
<span class="n">F2</span><span class="o">=</span><span class="n">CircAperture</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
<span class="n">F3</span><span class="o">=</span><span class="n">CircAperture</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>  
<span class="n">F</span><span class="o">=</span><span class="n">BeamMix</span><span class="p">(</span><span class="n">BeamMix</span><span class="p">(</span><span class="n">F1</span><span class="p">,</span><span class="n">F2</span><span class="p">),</span><span class="n">F3</span><span class="p">)</span>
<span class="n">I0</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">F</span><span class="o">=</span><span class="n">Fresnel</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">I1</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Plane of the screen&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/c49fdc2cdb647bbd8fed26385e888639/ThreeHoles.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/f7239ce6daca89abc3a8570f85700063/ThreeHoles_00_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/8949df60579c1ad168b7adab341d82df/ThreeHoles_00_00.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/d00c3fd62ad460bfdc741404f969285b/ThreeHoles_00_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/ThreeHoles_00_00.png" class="plot-directive" src="_images/ThreeHoles_00_00.png" />
</figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Intensity distribution a distance z from the screen&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/36cb544336e40f3aa358af87f65aaa78/ThreeHoles_01_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/1847877ed66ddcad5baaad0886d3059a/ThreeHoles_01_00.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/944ab60f48b34596c5ab1d058da46ac6/ThreeHoles_01_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/ThreeHoles_01_00.png" class="plot-directive" src="_images/ThreeHoles_01_00.png" />
</figure>
<p><em>Fig. 8. Intensity distributions in the plane of the screen and 75cm behind the screen.</em></p>
<p>The next interferometer is more interesting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#! python3</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">wavelength</span><span class="o">=</span><span class="mi">550</span><span class="o">*</span><span class="n">nm</span>
<span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">mm</span>
<span class="n">N</span><span class="o">=</span><span class="mi">128</span>
<span class="n">w</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">mm</span>
<span class="n">h</span><span class="o">=</span><span class="mf">2.5</span><span class="o">*</span><span class="n">mm</span>
<span class="n">phi</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="n">rad</span>
<span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">mm</span>
<span class="n">z</span><span class="o">=</span><span class="mi">75</span><span class="o">*</span><span class="n">cm</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">F1</span> <span class="o">=</span> <span class="n">RectAperture</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span><span class="o">-</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
<span class="n">F2</span> <span class="o">=</span> <span class="n">RectAperture</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span> 
<span class="n">F</span><span class="o">=</span><span class="n">BeamMix</span><span class="p">(</span><span class="n">F1</span><span class="p">,</span><span class="n">F2</span><span class="p">)</span>
<span class="n">I0</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">F</span><span class="o">=</span><span class="n">Fresnel</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">I1</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I0</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">);</span><span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Plane of the screen&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">);</span><span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Intensity distribution at a distance z from the screen&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/79650844f63db28856a2b41fcbf29307/TwoSlitsTilt1.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/9937bec2cdc396bb193fc4f3dc093eea/TwoSlitsTilt1.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/71209b2e8c9446548ed3cf50335ab954/TwoSlitsTilt1.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/dad05a9727b53dcf3f7c7d24dfe59262/TwoSlitsTilt1.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/TwoSlitsTilt1.png" class="plot-directive" src="_images/TwoSlitsTilt1.png" />
</figure>
<p><em>Fig. 9. Intensity distributions in the plane of the screen and 75cm behind the screen.</em></p>
<p>In the last example the intensity distribution is modulated by the wave, reflected from the grid edge, nevertheless it gives a good impression about the general character of the interference pattern. To obtain a better result, the calculations should be conducted in a larger grid or other numerical method should be used. The following example uses a direct integration algorithm (the input and output are in different scales and have different samplings):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#! python3</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">wavelength</span><span class="o">=</span><span class="mi">550</span><span class="o">*</span><span class="n">nm</span>
<span class="n">size</span><span class="o">=</span><span class="mf">2.6</span><span class="o">*</span><span class="n">mm</span>
<span class="n">N</span><span class="o">=</span><span class="mi">64</span>
<span class="n">w</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">mm</span>
<span class="n">h</span><span class="o">=</span><span class="mf">2.5</span><span class="o">*</span><span class="n">mm</span>
<span class="n">phi</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="n">rad</span>
<span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">mm</span>
<span class="n">z</span><span class="o">=</span><span class="mi">75</span><span class="o">*</span><span class="n">cm</span>
<span class="n">sizenew</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">mm</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">F1</span> <span class="o">=</span> <span class="n">RectAperture</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span><span class="o">-</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
<span class="n">F2</span> <span class="o">=</span> <span class="n">RectAperture</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span> 
<span class="n">F</span><span class="o">=</span><span class="n">BeamMix</span><span class="p">(</span><span class="n">F1</span><span class="p">,</span><span class="n">F2</span><span class="p">)</span>
<span class="n">I0</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">F</span><span class="o">=</span><span class="n">Forward</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">sizenew</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">I1</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I0</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">);</span><span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Plane of the screen&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">);</span><span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Intensity distribution at a distance z from the screen&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/ad89dbeb112b6553ae0d631e155865b7/TwoSlitsTilt2.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/f73e727ac277a6ea14c0c057ef6716f3/TwoSlitsTilt2.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/57c4a97b37b674d558f918ea2fc5d075/TwoSlitsTilt2.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/4a67d7d2e19118a1df9b40464099c7aa/TwoSlitsTilt2.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/TwoSlitsTilt2.png" class="plot-directive" src="_images/TwoSlitsTilt2.png" />
</figure>
<p><em>Fig. 10. Intensity distributions in plane of the screen and 75 cm after the screen, note that input and output have different scales, input grid is 2.5x2.5mm, output is 5x5mm.</em></p>
<p>This example uses approximately 25 times less memory than the previous FFT. The calculation may take long execution time to tens of seconds or more, depending on the speed of the computer.</p>
</section>
<section id="interpolation">
<h2><span class="section-number">6.4. </span>Interpolation.<a class="headerlink" href="#interpolation" title="Link to this heading"></a></h2>
<p>The command <a class="reference internal" href="command-reference.html#LightPipes.Interpol" title="LightPipes.Interpol"><code class="xref py py-func docutils literal notranslate"><span class="pre">Interpol</span></code></a> is the tool for manipulating the size and the dimension of the grid and for changing the shift, rotation and the scale of the field distribution. It accepts six command line arguments, the first is the new size of the grid. The second argument gives the new number of points, the third gives the value of transverse shift in the X direction, the fourth gives the shift in the Y direction, the fifth gives the field rotation (first shift and then rotation). The last sixth argument determines the magnification, its action is equivalent to passing the beam through a focal system with magnification M (without diffraction, but preserving the integral intensity). For example if the field was propagated with the FFT algorithm <a class="reference internal" href="command-reference.html#LightPipes.Forvard" title="LightPipes.Forvard"><code class="xref py py-func docutils literal notranslate"><span class="pre">Forvard</span></code></a>, then the grid contains empty borders, which is not necessary if we want to propagate the field further with <a class="reference internal" href="command-reference.html#LightPipes.Forward" title="LightPipes.Forward"><code class="xref py py-func docutils literal notranslate"><span class="pre">Forward</span></code></a>. Other way around, after <em>Forward</em> we have to add some empty borders to continue with <a class="reference internal" href="command-reference.html#LightPipes.Forvard" title="LightPipes.Forvard"><code class="xref py py-func docutils literal notranslate"><span class="pre">Forvard</span></code></a>. <a class="reference internal" href="command-reference.html#LightPipes.Interpol" title="LightPipes.Interpol"><code class="xref py py-func docutils literal notranslate"><span class="pre">Interpol</span></code></a> is useful for interpolating into a grid with different size and number of points. Of course it is not too wise to interpolate from a grid of 512x512 points into a grid of 8x8, and then back because all information about the field will be lost. The same is true for interpolating the  grid of 1mx1m to 1mmx1mm and back. When interpolating into a grid with larger size, for example from 1x1 to 2x2, the program puts zeros into the new added regions. Figure 11 illustrates the usage of <em>Interpol</em> for the transition from a fine grid used by <a class="reference internal" href="command-reference.html#LightPipes.Forvard" title="LightPipes.Forvard"><code class="xref py py-func docutils literal notranslate"><span class="pre">Forvard</span></code></a> (near field) to a coarse grid used by <a class="reference internal" href="command-reference.html#LightPipes.Forward" title="LightPipes.Forward"><code class="xref py py-func docutils literal notranslate"><span class="pre">Forward</span></code></a> (far field).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#! python3</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>

<span class="nb">print</span><span class="p">(</span><span class="n">LPversion</span><span class="p">)</span>
<span class="n">wavelength</span><span class="o">=</span><span class="mi">1000</span><span class="o">*</span><span class="n">nm</span>
<span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">mm</span>
<span class="n">N</span><span class="o">=</span><span class="mi">256</span>
<span class="n">w</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">mm</span>

<span class="n">z</span><span class="o">=</span><span class="mi">400</span><span class="o">*</span><span class="n">m</span>
<span class="n">sizenew</span><span class="o">=</span><span class="mi">400</span><span class="o">*</span><span class="n">mm</span>
<span class="n">Nnew</span><span class="o">=</span><span class="mi">64</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">RectAperture</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">Forvard</span><span class="p">(</span><span class="mf">0.2</span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">I0</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">Interpol</span><span class="p">(</span><span class="mf">7.5</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span><span class="n">Nnew</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">F</span><span class="o">=</span><span class="n">Forward</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">sizenew</span><span class="p">,</span><span class="n">Nnew</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">I1</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">I1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">);</span><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;near field&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/aa9858e703cd2c4ea54792b52dbdfc14/Interpol.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/26e93deb7384f673e417d43231823b53/Interpol_00_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/4288d6ce4642ee11400bbc78848f34bd/Interpol_00_00.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/48c3a045adf9e61ae0e9446a4a60b0a1/Interpol_00_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/Interpol_00_00.png" class="plot-directive" src="_images/Interpol_00_00.png" />
</figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">Nnew</span><span class="p">)</span>
<span class="n">Y</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">Nnew</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span> 
<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span>
                <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;far field&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/cf38e07e10eeeda1987e9b39104d3c1e/Interpol_01_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/d1ce6bfb7b7dc2e2f40f1d755b511fd6/Interpol_01_00.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/f960c911c3c94510a04633b842d7b4b7/Interpol_01_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/Interpol_01_00.png" class="plot-directive" src="_images/Interpol_01_00.png" />
</figure>
<p><em>Fig. 11. Illustration of the usage of Interpol for the transition from a fine grid used by Forvard (near field) to a coarse grid used by Forward (far field).</em></p>
</section>
<section id="phase-and-intensity-filters">
<h2><span class="section-number">6.5. </span>Phase and intensity filters.<a class="headerlink" href="#phase-and-intensity-filters" title="Link to this heading"></a></h2>
<p>There are four kinds of phase filters available in LightPipes -wave front tilt, the quadratic phase corrector called lens, a general aberration in the form of a Zernike polynomial, and a user defined filter. To illustrate the usage of these filters let’s consider the following examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">size</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="n">mm</span>
<span class="n">wavelength</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">um</span>
<span class="n">N</span><span class="o">=</span><span class="mi">256</span>
<span class="n">w</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span>
<span class="n">f</span><span class="o">=</span><span class="mi">8</span><span class="o">*</span><span class="n">m</span>
<span class="n">z</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">m</span>

<span class="n">Field</span> <span class="o">=</span> <span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">RectAperture</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">Lens</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">I0</span> <span class="o">=</span> <span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">phi0</span> <span class="o">=</span> <span class="n">Phase</span><span class="p">(</span><span class="n">Field</span><span class="p">)</span>

<span class="n">Field</span> <span class="o">=</span> <span class="n">Forvard</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">I1</span> <span class="o">=</span> <span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>

<span class="n">x</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">size</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">phi0</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)]);</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [mm]&#39;</span><span class="p">);</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase [rad]&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I0</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">);</span> <span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/c6f9db0c84958caf5483f89e46bc21b5/Lens.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/a494f5502b1019d5ceb495f83834e93c/Lens.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/dce9d89c8a0ed1df8f3101eef60324f4/Lens.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/c6573bceb64e991138e0edcb6e5e20d2/Lens.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/Lens.png" class="plot-directive" src="_images/Lens.png" />
</figure>
<p><em>Fig. 12. The phase distribution after passing the lens, intensity in the plane of the lens and at a distance equal to the half of the focal distance. (from left to right)</em></p>
<p>The first sequence of operators forms the initial structure, filters the field through the rectangular aperture and then filters the field through a positive lens with optical power of 0.125D (the focal distance of <span class="math notranslate nohighlight">\(1/0.125=8m\)</span> ). With the second command we propagate the field 4m forward. As 4m is exactly the half of the focal distance, the cross section of the beam must be reduces twice.</p>
<p>We have to be very careful propagating the field to the distance which is close to the focal distance of a positive lens- the near—focal intensity and phase distributions are localised in the central region of the grid occupying only a few grid points. This leads to the major loss of information about the field distribution. The problem is solved by applying the co-ordinate system which is tied to the divergent or convergent light beam, the tools to do this will be described later.</p>
<p>The lens may be decentered, <em>Lens(8, 0.01, 0.01, Field)</em> produces the lens with a focal length of <span class="math notranslate nohighlight">\(1/0.125\)</span>  shifted by 0.01 in X and Y directions. Note, when the lens is shifted, the aperture of the lens is not shifted, the light beam is not shifted also, only the phase mask correspondents to the lens is shifted.</p>
<p>The wave front tilt is illustrated by following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">size</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="n">mm</span>
<span class="n">wavelength</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">um</span>
<span class="n">N</span><span class="o">=</span><span class="mi">256</span>
<span class="n">w</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">mm</span>
<span class="n">z</span><span class="o">=</span><span class="mi">8</span><span class="o">*</span><span class="n">m</span>
<span class="n">tx</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">mrad</span>
<span class="n">ty</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">mrad</span>

<span class="n">Field</span> <span class="o">=</span> <span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">RectAperture</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">Tilt</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="n">ty</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">I0</span> <span class="o">=</span> <span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>


<span class="n">Field</span> <span class="o">=</span> <span class="n">Forvard</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">I1</span> <span class="o">=</span> <span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">phi1</span> <span class="o">=</span> <span class="n">Phase</span><span class="p">(</span><span class="n">Field</span><span class="p">)</span>

<span class="n">x</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">size</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>


<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">I1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)]);</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [mm]&#39;</span><span class="p">);</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity [a.u.]&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">phi1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)]);</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [mm]&#39;</span><span class="p">);</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase [rad]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/9d5366ad57af660e0b28370b33bd200c/Tilt.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/4df81b2c2499bbfccdedbe5d7376ea1e/Tilt.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/8de353d389b6659242474418b56e95da/Tilt.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/1822297a86a45668cab7fb47e85db116/Tilt.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/Tilt.png" class="plot-directive" src="_images/Tilt.png" />
</figure>
<p><em>Fig. 13. The intensity and the phase after tilting the wave front by 0.1 mrad and propagating it z = 8 m forward. Note the transversal shift of the intensity distribution and the phase tilt.</em></p>
<p>In this example the wave front was tilted by <span class="math notranslate nohighlight">\(\alpha = 0.1 mrad\)</span> in X and Y directions, then propagated to the distance <span class="math notranslate nohighlight">\(z = 8 m\)</span> , so in the output distribution we observe the transversal shift of the whole intensity distribution by <span class="math notranslate nohighlight">\(\alpha z = 0.8 mm\)</span> .</p>
</section>
<section id="zernike-polynomials">
<h2><span class="section-number">6.6. </span>Zernike polynomials.<a class="headerlink" href="#zernike-polynomials" title="Link to this heading"></a></h2>
<p>Any aberration in a circle can be decomposed over a sum of Zernike polynomials. Formulas given in <a class="footnote-reference brackets" href="#f7" id="id13" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a> have been directly implemented in LightPipes. The command is called <a class="reference internal" href="command-reference.html#LightPipes.Zernike" title="LightPipes.Zernike"><code class="xref py py-func docutils literal notranslate"><span class="pre">Zernike</span></code></a> and accepts four command line arguments:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The radial order n (first column in Table 13.2 <a class="footnote-reference brackets" href="#f8" id="id14" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a> p. 465).</p></li>
<li><p>The azimuthal order <span class="math notranslate nohighlight">\(m\)</span> , <span class="math notranslate nohighlight">\(|m| &lt;= n\)</span> , polynomials with negative <span class="math notranslate nohighlight">\(n\)</span> are rotated
<span class="math notranslate nohighlight">\(90^{\circ}\)</span>  relative to the polynomials with positive n. For example <em>Zernike(5,3,1,1,Field)</em> gives
the same aberration as <em>Zernike(5,-3,1,1,Field)</em>, but the last is rotated <span class="math notranslate nohighlight">\(90^{\circ}\)</span> .
This index corresponds to the <span class="math notranslate nohighlight">\(n-2m\)</span> given in the third column of Table 13.2 in <a class="footnote-reference brackets" href="#f8" id="id15" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a> , p. 465.</p></li>
<li><p>The radius, R.</p></li>
<li><p>The amplitude of aberration in radians at R.</p></li>
</ol>
</div></blockquote>
<p>We can uniformly introduce <a class="reference internal" href="command-reference.html#LightPipes.Lens" title="LightPipes.Lens"><code class="xref py py-func docutils literal notranslate"><span class="pre">Lens</span></code></a> and <a class="reference internal" href="command-reference.html#LightPipes.Tilt" title="LightPipes.Tilt"><code class="xref py py-func docutils literal notranslate"><span class="pre">Tilt</span></code></a> with <a class="reference internal" href="command-reference.html#LightPipes.Zernike" title="LightPipes.Zernike"><code class="xref py py-func docutils literal notranslate"><span class="pre">Zernike</span></code></a>, the difference is that we pass the amplitude of the aberration to  <a class="reference internal" href="command-reference.html#LightPipes.Lens" title="LightPipes.Lens"><code class="xref py py-func docutils literal notranslate"><span class="pre">Lens</span></code></a>, <a class="reference internal" href="command-reference.html#LightPipes.Tilt" title="LightPipes.Tilt"><code class="xref py py-func docutils literal notranslate"><span class="pre">Tilt</span></code></a> and <a class="reference internal" href="command-reference.html#LightPipes.Zernike" title="LightPipes.Zernike"><code class="xref py py-func docutils literal notranslate"><span class="pre">Zernike</span></code></a> accept conventional meters and radians, which are widely in use for the description of optical setups, while <a class="reference internal" href="command-reference.html#LightPipes.Zernike" title="LightPipes.Zernike"><code class="xref py py-func docutils literal notranslate"><span class="pre">Zernike</span></code></a> uses the amplitude of the aberration, which frequently has to be derived from the technical description.</p>
<p>A cylindrical lens can be modelled as a combination of two <a class="reference internal" href="command-reference.html#LightPipes.Zernike" title="LightPipes.Zernike"><code class="xref py py-func docutils literal notranslate"><span class="pre">Zernike</span></code></a> commands:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="n">mm</span>
<span class="n">wavelength</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">um</span>
<span class="n">N</span><span class="o">=</span><span class="mi">500</span>
<span class="n">R</span><span class="o">=</span><span class="mf">4.5</span><span class="o">*</span><span class="n">mm</span>
<span class="n">z</span><span class="o">=</span><span class="mf">1.89</span><span class="o">*</span><span class="n">m</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">wavelength</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">CircAperture</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="n">I0</span> <span class="o">=</span> <span class="n">Intensity</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">Zernike</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="o">*</span><span class="n">A</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">Zernike</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="mi">10</span><span class="o">*</span><span class="n">A</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">Field</span> <span class="o">=</span> <span class="n">Fresnel</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>
<span class="c1">#Field = Interpol(size,N,0,0,-45,1,Field)</span>
<span class="n">I1</span> <span class="o">=</span> <span class="n">Intensity</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span>
<span class="n">I1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I1</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">size</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">size</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">mm</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I0</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">);</span> <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">I1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span><span class="n">x</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">I1</span><span class="p">))[</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [mm]&#39;</span><span class="p">);</span><span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity [a.u.]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/1207348f62bf52d1f1c3f4f1db6830ef/CylindricalLens.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/e1bf5c822bbf7760e953498d97f783dc/CylindricalLens.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/b8e98fc070bea1f4520fae1302faad4a/CylindricalLens.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/873d34d64e12db3c3a964afbb59fc332/CylindricalLens.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/CylindricalLens.png" class="plot-directive" src="_images/CylindricalLens.png" />
</figure>
<p><em>Fig. 14. The intensity in the input plane and after propagation through a cylindrical system modelled as a combination of Zernike polynomials and free space propagation.</em></p>
</section>
<section id="spherical-coordinates">
<h2><span class="section-number">6.7. </span>Spherical coordinates.<a class="headerlink" href="#spherical-coordinates" title="Link to this heading"></a></h2>
<p>The principle of beam propagation in the “floating” co-ordinate system (for the case of a lens wave guide) is shown in Figure 15.</p>
<figure class="align-default">
<img alt="_images/spherical_coordinates.png" src="_images/spherical_coordinates.png" />
</figure>
<p><em>Fig. 15. The intensity in the input plane and after propagation through a cylindrical system modelled as a combination of Zernike polynomials and free space propagation.</em></p>
<p>The spherical coordinates follow the geometrical section of the divergent or convergent light beam. Propagation in spherical coordinates is implemented with the commands <a class="reference internal" href="command-reference.html#LightPipes.LensForvard" title="LightPipes.LensForvard"><code class="xref py py-func docutils literal notranslate"><span class="pre">LensForvard</span></code></a> and <a class="reference internal" href="command-reference.html#LightPipes.LensFresnel" title="LightPipes.LensFresnel"><code class="xref py py-func docutils literal notranslate"><span class="pre">LensFresnel</span></code></a>. Both commands accept two parameters: the focal distance of the lens, and the distance of propagation. When <a class="reference internal" href="command-reference.html#LightPipes.LensForvard" title="LightPipes.LensForvard"><code class="xref py py-func docutils literal notranslate"><span class="pre">LensForvard</span></code></a> or <a class="reference internal" href="command-reference.html#LightPipes.LensFresnel" title="LightPipes.LensFresnel"><code class="xref py py-func docutils literal notranslate"><span class="pre">LensFresnel</span></code></a> is called, it “bends” the coordinate system so, that it follows the divergent or convergent spherical wave front, and then propagates the field to the distance z in the transformed coordinates. The command <em>Convert</em> should be used to convert the field back to the rectangular coordinate system. Some LightPipes commands can not be applied to the field in spherical coordinates. As the coordinates follow the geometrical section of the light beam, operator <em>LensForvard(10,10,Field)</em> will produce floating exception because the calculations can not be conducted in a grid with zero size (that is so in the geometrical approximation of a focal point). On the other hand, diffraction to the focus is equivalent to the diffraction to the far field (infinity), thus the FFT convolution algorithm will not work properly anyway. To model the diffraction into the focal point, a more complicated trick should be used:</p>
<p>In Figure 16 we calculate the diffraction to the focus of a lens with a focal distance of 1m and compare the spherical coordinate method with the simple straight forward method of a lens followed by propagation to its focus. The spherical coordinates method uses the combination of a weak phase mask <em>Lens(f1, F)</em> and a “strong” geometrical coordinate transform <em>LensFresnel(f2, z, F)</em>. The grid after propagation is 10 times narrower than in the input plane. The focal intensity is 650 times higher than the input intensity and the wave front is plain as expected.</p>
<p>The straight-forward method uses the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">labda</span><span class="o">=</span><span class="m">1000</span>*nm<span class="p">;</span>
<span class="nv">size</span><span class="o">=</span><span class="m">10</span>*mm<span class="p">;</span>
<span class="nv">f</span><span class="o">=</span><span class="m">100</span>*cm
<span class="nv">w</span><span class="o">=</span><span class="m">5</span>*mm<span class="p">;</span>
<span class="nv">F</span><span class="o">=</span>Begin<span class="o">(</span>size,labda,N<span class="o">)</span><span class="p">;</span>
<span class="nv">F</span><span class="o">=</span>RectAperture<span class="o">(</span>w,w,0,0,0,F<span class="o">)</span><span class="p">;</span>
<span class="nv">F1</span><span class="o">=</span>Lens<span class="o">(</span>f,0,0,F<span class="o">)</span>
<span class="nv">F1</span><span class="o">=</span>Fresnel<span class="o">(</span>f,F1<span class="o">)</span>
<span class="nv">phi1</span><span class="o">=</span>Phase<span class="o">(</span>F1<span class="o">)</span><span class="p">;</span><span class="nv">phi1</span><span class="o">=</span>PhaseUnwrap<span class="o">(</span>phi1<span class="o">)</span>
<span class="nv">I1</span><span class="o">=</span>Intensity<span class="o">(</span><span class="m">0</span>,F1<span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p>to calculate the field at the focus of a positive lens.</p>
<p>The method with spherical coordinates is slightly more complex:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">labda</span><span class="o">=</span><span class="m">1000</span>*nm<span class="p">;</span>
<span class="nv">size</span><span class="o">=</span><span class="m">10</span>*mm<span class="p">;</span>
<span class="nv">f</span><span class="o">=</span><span class="m">100</span>*cm
<span class="nv">w</span><span class="o">=</span><span class="m">5</span>*mm<span class="p">;</span>
<span class="nv">f1</span><span class="o">=</span><span class="m">10</span>*m
<span class="nv">f2</span><span class="o">=</span>f1*f/<span class="o">(</span>f1-f<span class="o">)</span>
<span class="nv">frac</span><span class="o">=</span>f/f1
<span class="nv">newsize</span><span class="o">=</span>frac*size
<span class="nv">F</span><span class="o">=</span>Begin<span class="o">(</span>size,labda,N<span class="o">)</span><span class="p">;</span>
<span class="nv">F</span><span class="o">=</span>RectAperture<span class="o">(</span>w,w,0,0,0,F<span class="o">)</span><span class="p">;</span>
<span class="nv">F2</span><span class="o">=</span>Lens<span class="o">(</span>f1,0,0,F<span class="o">)</span><span class="p">;</span>
<span class="nv">F2</span><span class="o">=</span>LensFresnel<span class="o">(</span>f2,f,F2<span class="o">)</span><span class="p">;</span>
<span class="nv">F2</span><span class="o">=</span>Convert<span class="o">(</span>F2<span class="o">)</span><span class="p">;</span>
<span class="nv">phi2</span><span class="o">=</span>Phase<span class="o">(</span>F2<span class="o">)</span><span class="p">;</span><span class="nv">phi2</span><span class="o">=</span>PhaseUnwrap<span class="o">(</span>phi2<span class="o">)</span>
<span class="nv">I2</span><span class="o">=</span>Intensity<span class="o">(</span><span class="m">0</span>,F2<span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p>The bending of the coordinate system for the <a class="reference internal" href="command-reference.html#LightPipes.LensFresnel" title="LightPipes.LensFresnel"><code class="xref py py-func docutils literal notranslate"><span class="pre">LensFresnel</span></code></a> command is given by
<span class="math notranslate nohighlight">\(f_2\)</span>.
The results for <span class="math notranslate nohighlight">\(f=100 cm\)</span> and <span class="math notranslate nohighlight">\(f=10 cm\)</span> are shown in figures 16a+b where the two methods are compared.
As can been seen the straight-forward method requires much larger grid dimensions and hence
longer execution time. This is especially the case for stronger lenses (shorter focal lengths).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">TheExample</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mf">9.5</span><span class="p">))</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
    <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
    <span class="n">labda</span><span class="o">=</span><span class="mi">1000</span><span class="o">*</span><span class="n">nm</span><span class="p">;</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span>

    <span class="n">f</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">cm</span>
    <span class="n">f1</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">m</span>
    <span class="n">f2</span><span class="o">=</span><span class="n">f1</span><span class="o">*</span><span class="n">f</span><span class="o">/</span><span class="p">(</span><span class="n">f1</span><span class="o">-</span><span class="n">f</span><span class="p">)</span>
    <span class="n">frac</span><span class="o">=</span><span class="n">f</span><span class="o">/</span><span class="n">f1</span>
    <span class="n">newsize</span><span class="o">=</span><span class="n">frac</span><span class="o">*</span><span class="n">size</span>
    <span class="n">w</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span>
    <span class="n">F</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">labda</span><span class="p">,</span><span class="n">N</span><span class="p">);</span>
    <span class="n">F</span><span class="o">=</span><span class="n">RectAperture</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>

<span class="c1">#1) Using Lens and Fresnel:</span>
    <span class="n">F1</span><span class="o">=</span><span class="n">Lens</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
    <span class="n">F1</span><span class="o">=</span><span class="n">Fresnel</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">F1</span><span class="p">)</span>
    <span class="n">phi1</span><span class="o">=</span><span class="n">Phase</span><span class="p">(</span><span class="n">F1</span><span class="p">);</span><span class="n">phi1</span><span class="o">=</span><span class="n">PhaseUnwrap</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span>
    <span class="n">I1</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">F1</span><span class="p">);</span>
    <span class="n">x1</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">x1</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">size</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>  

<span class="c1">#2) Using Lens + LensFresnel and Convert:</span>
    <span class="n">F2</span><span class="o">=</span><span class="n">Lens</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>
    <span class="n">F2</span><span class="o">=</span><span class="n">LensFresnel</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">F2</span><span class="p">);</span>
    <span class="n">F2</span><span class="o">=</span><span class="n">Convert</span><span class="p">(</span><span class="n">F2</span><span class="p">);</span>
    <span class="n">phi2</span><span class="o">=</span><span class="n">Phase</span><span class="p">(</span><span class="n">F2</span><span class="p">);</span><span class="n">phi2</span><span class="o">=</span><span class="n">PhaseUnwrap</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span>
    <span class="n">I2</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">F2</span><span class="p">);</span>
    <span class="n">x2</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">x2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="n">newsize</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">newsize</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">phi1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Without spherical coordinates&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">phi2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;With spherical coordinates&#39;</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">newsize</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">mm</span><span class="p">,</span><span class="n">newsize</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [mm]&#39;</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;phase [rad]&#39;</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;phase, N = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">N</span><span class="p">)</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">I1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Without spherical coordinates&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">I2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;With spherical coordinates&#39;</span><span class="p">);</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">newsize</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">mm</span><span class="p">,</span><span class="n">newsize</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [mm]&#39;</span><span class="p">);</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity [a.u.]&#39;</span><span class="p">);</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;intensity, N = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">N</span><span class="p">)</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I1</span><span class="p">);</span><span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span><span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Without spherical coordinates&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">frac</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">frac</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">frac</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">frac</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I2</span><span class="p">);</span><span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span><span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;With spherical coordinates&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="s1">&#39;Spherical Coordinates, f = 100cm lens</span><span class="se">\n</span><span class="s1">Grid dimension is: </span><span class="si">%d</span><span class="s1"> x </span><span class="si">%d</span><span class="s1"> pixels&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">18</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="n">TheExample</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="c1">#100 x 100 grid</span>

<span class="n">TheExample</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="c1">#1000 x 1000 grid</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/0adc6cf3b6d71b470ccea762b0b9d064/LensFresnel_Convert_f100cm.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
<figure class="align-default" id="id17">
<img alt="_images/LensFresnel_Convert_f100cm_00.png" class="plot-directive" src="_images/LensFresnel_Convert_f100cm_00.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/9cd74f7dba5561e7dac40661700d54fb/LensFresnel_Convert_f100cm_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/22e5fc72aeb9bb0fea1daba22b99907f/LensFresnel_Convert_f100cm_00.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/cd03108989f56080fd50b026eacbbf11/LensFresnel_Convert_f100cm_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id17" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id18">
<img alt="_images/LensFresnel_Convert_f100cm_01.png" class="plot-directive" src="_images/LensFresnel_Convert_f100cm_01.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/f35151985bd01e9d70ff4b34c67be502/LensFresnel_Convert_f100cm_01.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/92c79175b333aa48ff41924dc94be41f/LensFresnel_Convert_f100cm_01.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/2dacae935448811268ef8ffa9dc26a3f/LensFresnel_Convert_f100cm_01.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id18" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><em>Fig. 16a. Diffraction to the focus of a f=100 cm lens. The use of a spherical coordinate system (LensFresnel + Convert)
is compared with the straight-forward method (Lens + Fresnel).</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">TheExample</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mf">9.5</span><span class="p">))</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
    <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>

    <span class="n">labda</span><span class="o">=</span><span class="mi">1000</span><span class="o">*</span><span class="n">nm</span><span class="p">;</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span>

    <span class="n">f</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">cm</span>
    <span class="n">f1</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">m</span>
    <span class="n">f2</span><span class="o">=</span><span class="n">f1</span><span class="o">*</span><span class="n">f</span><span class="o">/</span><span class="p">(</span><span class="n">f1</span><span class="o">-</span><span class="n">f</span><span class="p">)</span>
    <span class="n">frac</span><span class="o">=</span><span class="n">f</span><span class="o">/</span><span class="n">f1</span>
    <span class="n">newsize</span><span class="o">=</span><span class="n">frac</span><span class="o">*</span><span class="n">size</span>
    <span class="n">w</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span>
    <span class="n">F</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">labda</span><span class="p">,</span><span class="n">N</span><span class="p">);</span>
    <span class="n">F</span><span class="o">=</span><span class="n">RectAperture</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>

<span class="c1">#1) Using Lens and Fresnel:</span>
    <span class="n">F1</span><span class="o">=</span><span class="n">Lens</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
    <span class="n">F1</span><span class="o">=</span><span class="n">Fresnel</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">F1</span><span class="p">)</span>
    <span class="n">phi1</span><span class="o">=</span><span class="n">Phase</span><span class="p">(</span><span class="n">F1</span><span class="p">);</span><span class="n">phi1</span><span class="o">=</span><span class="n">PhaseUnwrap</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span>
    <span class="n">I1</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">F1</span><span class="p">);</span>
    <span class="n">x1</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">x1</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">size</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>  

<span class="c1">#2) Using Lens + LensFresnel and Convert:</span>
    <span class="n">F2</span><span class="o">=</span><span class="n">Lens</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>
    <span class="n">F2</span><span class="o">=</span><span class="n">LensFresnel</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">F2</span><span class="p">);</span>
    <span class="n">F2</span><span class="o">=</span><span class="n">Convert</span><span class="p">(</span><span class="n">F2</span><span class="p">);</span>
    <span class="n">phi2</span><span class="o">=</span><span class="n">Phase</span><span class="p">(</span><span class="n">F2</span><span class="p">);</span><span class="n">phi2</span><span class="o">=</span><span class="n">PhaseUnwrap</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span>
    <span class="n">I2</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">F2</span><span class="p">);</span>
    <span class="n">x2</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">x2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="n">newsize</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">newsize</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">phi1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Without spherical coordinates&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">phi2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;With spherical coordinates&#39;</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">newsize</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">mm</span><span class="p">,</span><span class="n">newsize</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [mm]&#39;</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;phase [rad]&#39;</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;phase, N = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">N</span><span class="p">)</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">I1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Without spherical coordinates&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">I2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;With spherical coordinates&#39;</span><span class="p">);</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">newsize</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">mm</span><span class="p">,</span><span class="n">newsize</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">mm</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100000</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [mm]&#39;</span><span class="p">);</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity [a.u.]&#39;</span><span class="p">);</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;intensity, N = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">N</span><span class="p">)</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I1</span><span class="p">);</span><span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span><span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Without spherical coordinates&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">frac</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">frac</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">frac</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">frac</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I2</span><span class="p">);</span><span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span><span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;With spherical coordinates&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="s1">&#39;Spherical Coordinates, f = 10cm lens</span><span class="se">\n</span><span class="s1">Grid dimension is: </span><span class="si">%d</span><span class="s1"> x </span><span class="si">%d</span><span class="s1"> pixels&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">18</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="n">TheExample</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="c1">#100 x 100 grid</span>

<span class="n">TheExample</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="c1">#1000 x 1000 grid</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/8af3caf9d682b7df88e57540d219ea87/LensFresnel_Convert_f10cm.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
<figure class="align-default" id="id19">
<img alt="_images/LensFresnel_Convert_f10cm_00.png" class="plot-directive" src="_images/LensFresnel_Convert_f10cm_00.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/c383ed36913d18e1473552e2123fb29c/LensFresnel_Convert_f10cm_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/161c934625ffacdd1b33848c1137e9de/LensFresnel_Convert_f10cm_00.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/c04e3fa108bd60be2dc786a597eaa734/LensFresnel_Convert_f10cm_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id19" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id20">
<img alt="_images/LensFresnel_Convert_f10cm_01.png" class="plot-directive" src="_images/LensFresnel_Convert_f10cm_01.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/fb8989a9faaf99b595a9cd5bc0e00f5f/LensFresnel_Convert_f10cm_01.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/37c4bd0e5ac87730aa56b05572087357/LensFresnel_Convert_f10cm_01.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/88c8be203a0658392cd05aa60685426f/LensFresnel_Convert_f10cm_01.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id20" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><em>Fig 16b. With a stronger lens the straight-forward method requires more grid points.</em></p>
</section>
<section id="user-defined-phase-and-intensity-filters">
<h2><span class="section-number">6.8. </span>User defined phase and intensity filters.<a class="headerlink" href="#user-defined-phase-and-intensity-filters" title="Link to this heading"></a></h2>
<p>The phase and intensity of the light beam can be manipulated in several ways. The phase and intensity distributions may be produced as shown in the next examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="n">mm</span>
<span class="n">wavelength</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">um</span>
<span class="n">N</span><span class="o">=</span><span class="mi">256</span>
<span class="n">R</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">mm</span>

<span class="n">Int</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">])</span>
<span class="n">phase</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
        <span class="n">Int</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mf">10.0</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">j</span><span class="o">/</span><span class="mf">5.0</span><span class="p">))</span>
        <span class="n">phase</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mf">10.0</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">j</span><span class="o">/</span><span class="mf">5.0</span><span class="p">)</span>
<span class="n">phase</span> <span class="o">=</span> <span class="mf">0.12345</span><span class="o">*</span><span class="n">rad</span>
<span class="n">F</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">F</span><span class="o">=</span><span class="n">SubIntensity</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="n">Int</span><span class="p">)</span>
<span class="n">F</span><span class="o">=</span><span class="n">SubPhase</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">F</span><span class="o">=</span><span class="n">CircAperture</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>

<span class="n">I</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">Phi</span><span class="o">=</span><span class="n">Phase</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>


<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">);</span> <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Intensity&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Phi</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;hot&#39;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Phase&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/664313d188ad136c1e20324a50ba4506/subintphase1.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/876d74de1f1f961e4b6008cc754236d9/subintphase1.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/17c0d84d6e4f4fdc5085eee3169e2f05/subintphase1.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/9463e9998aab48ce86799826b56ede89/subintphase1.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/subintphase1.png" class="plot-directive" src="_images/subintphase1.png" />
</figure>
<p><em>Fig. 17. An arbitrary intensity- and phase distribution.</em></p>
<p>You can also create your own mask with a program like Microsoft Paint. In the next example we made an arrow using Paint and stored it as a 200 pixels width x 200 pixels height, black-and-white, monochrome bitmap file (for example: arrow.png). This file can be read from disk. Next the arrow can be used as a filter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1">#Convert rgb to gray with weighted average of rgb pixels:</span>
<span class="k">def</span> <span class="nf">rgb2gray</span><span class="p">(</span><span class="n">rgb</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="o">...</span><span class="p">,:</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.299</span><span class="p">,</span> <span class="mf">0.587</span><span class="p">,</span> <span class="mf">0.114</span><span class="p">])</span>

<span class="c1">#read image from disk and check if it is square:</span>
<span class="n">img</span><span class="o">=</span><span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;arrow.png&#39;</span><span class="p">)</span>
<span class="c1">#print(img[100][1])</span>
<span class="n">img</span><span class="o">=</span><span class="n">rgb2gray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="c1">#print(img[100])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span> <span class="n">img</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span> <span class="p">)</span>
<span class="n">Nr</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Nc</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">if</span> <span class="n">Nc</span> <span class="o">!=</span> <span class="n">Nr</span><span class="p">:</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;image must be square&#39;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">N</span><span class="o">=</span><span class="n">Nc</span>

<span class="n">size</span><span class="o">=</span><span class="mi">25</span><span class="o">*</span><span class="n">mm</span>
<span class="n">wavelength</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">um</span>

<span class="n">R</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">mm</span>
<span class="n">xs</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">mm</span>
<span class="n">ys</span><span class="o">=</span><span class="mi">0</span><span class="o">*</span><span class="n">mm</span>

<span class="n">F</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">F</span><span class="o">=</span><span class="n">GaussAperture</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">F</span><span class="o">=</span><span class="n">MultIntensity</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="n">I</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Intensity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/452363c7af80f83973e7a4ff4420ee24/subintphase2.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/0610090e247f8b6246d5f43e0f937f38/subintphase2.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/85335367638a4b6cbb2503fa29de6d42/subintphase2.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/9fa1c9d3e626a8619a390446a67d369f/subintphase2.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/subintphase2.png" class="plot-directive" src="_images/subintphase2.png" />
</figure>
<p><em>Fig. 18. Illustration of importing a bit map from disk.</em></p>
</section>
<section id="random-filters">
<h2><span class="section-number">6.9. </span>Random filters.<a class="headerlink" href="#random-filters" title="Link to this heading"></a></h2>
<p>There are two random filters to introduce a random intensity or a random phase distribution in the field. The commands <a class="reference internal" href="command-reference.html#LightPipes.RandomIntensity" title="LightPipes.RandomIntensity"><code class="xref py py-func docutils literal notranslate"><span class="pre">RandomIntensity</span></code></a> and <a class="reference internal" href="command-reference.html#LightPipes.RandomPhase" title="LightPipes.RandomPhase"><code class="xref py py-func docutils literal notranslate"><span class="pre">RandomPhase</span></code></a> need a seed to initiate the random number generator. The <a class="reference internal" href="command-reference.html#LightPipes.RandomPhase" title="LightPipes.RandomPhase"><code class="xref py py-func docutils literal notranslate"><span class="pre">RandomPhase</span></code></a> command needs a maximum phase value (in radians). The <a class="reference internal" href="command-reference.html#LightPipes.RandomIntensity" title="LightPipes.RandomIntensity"><code class="xref py py-func docutils literal notranslate"><span class="pre">RandomIntensity</span></code></a> command yields a normalised random intensity distribution. The <em>RandomIntensity</em> and the <a class="reference internal" href="command-reference.html#LightPipes.RandomPhase" title="LightPipes.RandomPhase"><code class="xref py py-func docutils literal notranslate"><span class="pre">RandomPhase</span></code></a> commands leave the phase and the intensity unchanged respectively.</p>
</section>
<section id="fft-and-spatial-filters">
<h2><span class="section-number">6.10. </span>FFT and spatial filters.<a class="headerlink" href="#fft-and-spatial-filters" title="Link to this heading"></a></h2>
<p>LightPipes provide a possibility to perform arbitrary filtering in the Fourier space. There is an operator, performing the Fourier transform of the whole data structure: <a class="reference internal" href="command-reference.html#LightPipes.PipFFT" title="LightPipes.PipFFT"><code class="xref py py-func docutils literal notranslate"><span class="pre">PipFFT</span></code></a>.</p>
<p>To spatial filter a beam with an aperture the following code could be used:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="n">mm</span>
<span class="n">wavelength</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">um</span>
<span class="n">N</span><span class="o">=</span><span class="mi">150</span>
<span class="n">z</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span>
<span class="n">R</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">mm</span>
<span class="n">Rf</span><span class="o">=</span><span class="mf">1.5</span><span class="o">*</span><span class="n">mm</span>
<span class="n">seed</span><span class="o">=</span><span class="mi">7</span>
<span class="n">MaxPhase</span><span class="o">=</span><span class="mf">1.5</span>

<span class="n">F</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">N</span><span class="p">);</span>
<span class="n">F</span><span class="o">=</span><span class="n">CircAperture</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>
<span class="n">F</span><span class="o">=</span><span class="n">RandomPhase</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span><span class="n">MaxPhase</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>
<span class="n">F</span><span class="o">=</span><span class="n">Fresnel</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>
<span class="n">I0</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>

<span class="n">F</span><span class="o">=</span><span class="n">PipFFT</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>
<span class="n">F</span><span class="o">=</span><span class="n">CircAperture</span><span class="p">(</span><span class="n">Rf</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>
<span class="n">F</span><span class="o">=</span><span class="n">PipFFT</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>
<span class="n">I1</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">);</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I0</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">);</span> <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Unfiltered intensity&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Filtered intensity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/aaefb7464aa85c85abd7e9ad103067f0/PipFFT.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/ca2452c9765f4d284638a28ee0bacf04/PipFFT.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/d49e04a87ba8b2adc413edef0fec4477/PipFFT.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/f8daa5593084cda3841a810c1fc3dc61/PipFFT.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/PipFFT.png" class="plot-directive" src="_images/PipFFT.png" />
</figure>
<p><em>Fig. 19. Intensity distributions before and after applying a spatial filter.</em></p>
<p>Note, we still can apply all the intensity and phase filters in the Fourier-space. The whole grid size in the angular frequency domain corresponds to <span class="math notranslate nohighlight">\(\frac{2 \pi \lambda}{\Delta x}\)</span>, where <span class="math notranslate nohighlight">\(\Delta x\)</span> is the grid step. One step in the frequency domain corresponds to <span class="math notranslate nohighlight">\(\frac{2 \pi \lambda}{x}\)</span>, where <span class="math notranslate nohighlight">\(x\)</span> is the total size of the grid. LightPipes filters do not know about all these transformations, so the user should take care about setting the proper size (using the relations mentioned) of the filter (still in linear units) in the frequency domain.</p>
</section>
<section id="laser-amplifier">
<h2><span class="section-number">6.11. </span>Laser amplifier.<a class="headerlink" href="#laser-amplifier" title="Link to this heading"></a></h2>
<p>The <a class="reference internal" href="command-reference.html#LightPipes.Gain" title="LightPipes.Gain"><code class="xref py py-func docutils literal notranslate"><span class="pre">Gain</span></code></a> command introduces a simple single-layer model of a laser amplifier. The output field is given by:
<span class="math notranslate nohighlight">\(F_{out}(x,y) = F_{in}(x,y) e^{\alpha L_{gain}}\)</span>, with <span class="math notranslate nohighlight">\(\alpha = \dfrac{\alpha_0}{1 + {2 I(x,y)}/{I_{sat}}}\)</span>. <span class="math notranslate nohighlight">\(2\alpha L_{gain}\)</span> is the net round-trip intensity gain. <span class="math notranslate nohighlight">\(\alpha_0\)</span> is the small-signal intensity gain and <span class="math notranslate nohighlight">\(I_{sat}\)</span> is the saturation intensity of the gain medium with a length <span class="math notranslate nohighlight">\(L_{gain}\)</span>.</p>
<p>The intensity must be doubled because of the left- and right propagating fields in a normal resonator. (If only one field is propagating in one direction (ring laser) you should double <span class="math notranslate nohighlight">\(I_{sat}\)</span> to remove the factor 2 in the denominator).</p>
<p>The gain sheet should be at one of the mirrors of a (un)stable laser resonator.</p>
</section>
<section id="diagnostics">
<h2><span class="section-number">6.12. </span>Diagnostics.<a class="headerlink" href="#diagnostics" title="Link to this heading"></a></h2>
<section id="strehl-ratio">
<h3><span class="section-number">6.12.1. </span>Strehl ratio.<a class="headerlink" href="#strehl-ratio" title="Link to this heading"></a></h3>
<p>The <a class="reference internal" href="command-reference.html#LightPipes.Strehl" title="LightPipes.Strehl"><code class="xref py py-func docutils literal notranslate"><span class="pre">Strehl</span></code></a> command calculates the Strehl ratio of the field, defined as:</p>
<div class="math notranslate nohighlight">
\[S= \frac{(\int  \int Re(F_{in}(x,y)dxdy)^2  + (\int  \int Im(F_{in}(x,y)dxdy)^2}{(\int \int |(F_{in}(x,y)|dxdy)^2}\]</div>
<p>The next example calculates the Strehl ratio of a field with increasing random phase fluctuations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">wavelength</span><span class="o">=</span><span class="mf">1.0</span><span class="o">*</span><span class="n">um</span>
<span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="n">mm</span>
<span class="n">N</span><span class="o">=</span><span class="mi">200</span>
<span class="n">w</span><span class="o">=</span><span class="mi">25</span><span class="o">*</span><span class="n">mm</span>
<span class="n">S</span><span class="o">=</span><span class="p">[]</span>
<span class="n">MaxPhase</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">MaxPhase</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">seed</span><span class="o">=</span><span class="n">i</span>
    <span class="n">F</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
    <span class="n">F</span><span class="o">=</span><span class="n">RandomPhase</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span><span class="n">MaxPhase</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">F</span><span class="p">)</span>
    <span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Strehl</span><span class="p">(</span><span class="n">F</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MaxPhase</span><span class="p">,</span><span class="n">S</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Strehl ratio of a beam with random phase</span><span class="se">\n</span><span class="s1"> as a function of the amplitude of the phase fluctuations&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Strehl ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;MaxPhase&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/0fe1c002cd32cfc9106bfe14d60bac40/Strehl.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/64ba5e585dac8854c40482672660cd08/Strehl.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/a18ff5b9032b3faf2dc0cf04f39af738/Strehl.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/86c0be24940d8b3b57fee354ab37e21d/Strehl.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/Strehl.png" class="plot-directive" src="_images/Strehl.png" />
</figure>
<p><em>Fig. 21. Demonstration of the use of the Strehl function to calculate the Strehl ratio (beam quality).</em></p>
</section>
<section id="beam-power">
<h3><span class="section-number">6.12.2. </span>Beam power.<a class="headerlink" href="#beam-power" title="Link to this heading"></a></h3>
<p>The <a class="reference internal" href="command-reference.html#LightPipes.Power" title="LightPipes.Power"><code class="xref py py-func docutils literal notranslate"><span class="pre">Power</span></code></a> command returns the total beam power:</p>
<div class="math notranslate nohighlight">
\[P=\int \int(|F_{in}(x,y)|)^2dxdy\]</div>
</section>
<section id="field-normalization">
<h3><span class="section-number">6.12.3. </span>Field normalization.<a class="headerlink" href="#field-normalization" title="Link to this heading"></a></h3>
<p>The <a class="reference internal" href="command-reference.html#LightPipes.Normal" title="LightPipes.Normal"><code class="xref py py-func docutils literal notranslate"><span class="pre">Normal</span></code></a> command normalizes the field according to:</p>
<div class="math notranslate nohighlight">
\[F_{out}(x,y)=\frac{F_{in}(x,y)}{ \sqrt{P} }\]</div>
<div class="math notranslate nohighlight">
\[P=\int \int(|F_{in}(x,y)|)^2dxdy\]</div>
<p>where P is the total beam power.</p>
</section>
<section id="centroid">
<h3><span class="section-number">6.12.4. </span>Centroid.<a class="headerlink" href="#centroid" title="Link to this heading"></a></h3>
<p>The <a class="reference internal" href="command-reference.html#LightPipes.Centroid" title="LightPipes.Centroid"><code class="xref py py-func docutils literal notranslate"><span class="pre">Centroid</span></code></a> command calculates the centroid of the intensity distribution.
It also returns the indices of the Field array closest to the centroid coordinates.</p>
<div class="math notranslate nohighlight">
\[X_c=\frac{\int \int xI(x,y)dxdy}{\int \int I(x,y)dxdy}\]</div>
<div class="math notranslate nohighlight">
\[Y_c=\frac{\int \int yI(x,y)dxdy}{\int \int I(x,y)dxdy}\]</div>
</section>
<section id="beam-width">
<h3><span class="section-number">6.12.5. </span>Beam width.<a class="headerlink" href="#beam-width" title="Link to this heading"></a></h3>
<section id="d4-sigma">
<span id="id16"></span><h4><span class="section-number">6.12.5.1. </span><span class="math notranslate nohighlight">\(D4\sigma\)</span><a class="headerlink" href="#d4-sigma" title="Link to this heading"></a></h4>
<p>The <a class="reference internal" href="command-reference.html#LightPipes.D4sigma" title="LightPipes.D4sigma"><code class="xref py py-func docutils literal notranslate"><span class="pre">D4sigma</span></code></a> command returns the width of a beam in the horizontal and vertical direction. It is <span class="math notranslate nohighlight">\(4\)</span> times <span class="math notranslate nohighlight">\(\sigma\)</span>,
where <span class="math notranslate nohighlight">\(\sigma\)</span> is the standard deviation of the horizontal or vertical marginal distribution respectively.
Mathematically, the <span class="math notranslate nohighlight">\(D4\sigma\)</span> beam width in the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> dimension for the beam profile <span class="math notranslate nohighlight">\(I(x,y)\)</span> is expressed as:</p>
<div class="math notranslate nohighlight">
\[D4\sigma _x=4\sigma=4\sqrt{\frac{\int \int (x-X_c)^2I(x,y)dxdy}{\int \int I(x,y)dxdy}}\]</div>
<div class="math notranslate nohighlight">
\[D4\sigma _y=4\sigma=4\sqrt{\frac{\int \int (y-Y_c)^2I(x,y)dxdy}{\int \int I(x,y)dxdy}}\]</div>
<p>where <span class="math notranslate nohighlight">\(X_c\)</span> and <span class="math notranslate nohighlight">\(Y_c\)</span> are the coordinates of the <a class="reference internal" href="command-reference.html#LightPipes.Centroid" title="LightPipes.Centroid"><code class="xref py py-func docutils literal notranslate"><span class="pre">Centroid</span></code></a>.</p>
<p>The next example demonstrates the usage of <a class="reference internal" href="command-reference.html#LightPipes.D4sigma" title="LightPipes.D4sigma"><code class="xref py py-func docutils literal notranslate"><span class="pre">D4sigma</span></code></a> and <a class="reference internal" href="command-reference.html#LightPipes.Centroid" title="LightPipes.Centroid"><code class="xref py py-func docutils literal notranslate"><span class="pre">Centroid</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LightPipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">patches</span>

<span class="n">wavelength</span> <span class="o">=</span> <span class="mi">1500</span><span class="o">*</span><span class="n">nm</span>
<span class="n">size</span> <span class="o">=</span> <span class="mi">25</span><span class="o">*</span><span class="n">mm</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">500</span>

<span class="n">F</span><span class="o">=</span><span class="n">Begin</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">F</span><span class="o">=</span><span class="n">CircAperture</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="n">x_shift</span><span class="o">=-</span><span class="mi">6</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="n">y_shift</span><span class="o">=-</span><span class="mi">2</span><span class="o">*</span><span class="n">mm</span><span class="p">)</span>
<span class="n">F</span><span class="o">=</span><span class="n">Fresnel</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="mf">0.4</span><span class="o">*</span><span class="n">m</span><span class="p">)</span>
<span class="n">Xc</span><span class="p">,</span><span class="n">Yc</span><span class="p">,</span> <span class="n">NXc</span><span class="p">,</span> <span class="n">NYc</span> <span class="o">=</span><span class="n">Centroid</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
<span class="n">sx</span><span class="p">,</span> <span class="n">sy</span> <span class="o">=</span> <span class="n">D4sigma</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
<span class="n">I0</span><span class="o">=</span><span class="n">Intensity</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>

<span class="c1"># Axes ...</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">main_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">divider</span>  <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">main_ax</span><span class="p">)</span>
<span class="n">top_ax</span>   <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>   <span class="mf">1.05</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">main_ax</span><span class="p">)</span>
<span class="n">right_ax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">main_ax</span><span class="p">)</span>

<span class="c1"># Make some labels invisible</span>
<span class="n">top_ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">right_ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Labels ...</span>
<span class="n">main_ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X [mm]&#39;</span><span class="p">)</span>
<span class="n">main_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y [mm]&#39;</span><span class="p">)</span>
<span class="n">top_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity [a.u.]&#39;</span><span class="p">)</span>
<span class="n">right_ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Intensity [a.u.]&#39;</span><span class="p">)</span>

<span class="c1">#plot ...</span>
<span class="n">main_ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">xvalues</span><span class="o">/</span><span class="n">mm</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">yvalues</span><span class="o">/</span><span class="n">mm</span><span class="p">,</span> <span class="n">I0</span><span class="p">)</span>
<span class="n">main_ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">Xc</span><span class="o">/</span><span class="n">mm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">main_ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">Yc</span><span class="o">/</span><span class="n">mm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">main_ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">Xc</span><span class="o">/</span><span class="n">mm</span><span class="p">,</span> <span class="n">Yc</span><span class="o">/</span><span class="n">mm</span><span class="p">),</span> <span class="n">sx</span><span class="o">/</span><span class="n">mm</span><span class="p">,</span> <span class="n">sy</span><span class="o">/</span><span class="n">mm</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">))</span>
<span class="n">right_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">I0</span><span class="p">[:,</span><span class="n">NXc</span><span class="p">],</span><span class="n">F</span><span class="o">.</span><span class="n">yvalues</span><span class="o">/</span><span class="n">mm</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">top_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">xvalues</span><span class="o">/</span><span class="n">mm</span><span class="p">,</span><span class="n">I0</span><span class="p">[</span><span class="n">NYc</span><span class="p">,:],</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/656099bc4f87f10f2a1312624753a4eb/D4sigma.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/9e20830ffc7a648c90af3e323f57b210/D4sigma.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/a28666ca8282ab2cfd5e0dd7b60b4f05/D4sigma.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/16828266d130f658022f9045b3223280/D4sigma.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/D4sigma.png" class="plot-directive" src="_images/D4sigma.png" />
</figure>
</section>
</section>
</section>
<section id="references">
<h2><span class="section-number">6.13. </span>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f1" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id7">2</a>,<a role="doc-backlink" href="#id12">3</a>)</span>
<p>J.W. Goodman, Introduction to Fourier Optics, 49-56, McGraw-Hill (1968).</p>
</aside>
<aside class="footnote brackets" id="f2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id2">1</a>,<a role="doc-backlink" href="#id3">2</a>,<a role="doc-backlink" href="#id5">3</a>,<a role="doc-backlink" href="#id8">4</a>)</span>
<p>W.H. Southwell, J. Opt. Soc. Am., 71, 7-14 (1981).</p>
</aside>
<aside class="footnote brackets" id="f3" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id4">1</a>,<a role="doc-backlink" href="#id6">2</a>,<a role="doc-backlink" href="#id9">3</a>)</span>
<p>A.E. Siegman, E.A. Sziklas, Mode calculations in unstable resonators with flowing saturable gain: 2. Fast Fourier transform method, Applied Optics 14, 1874-1889 (1975).</p>
</aside>
<aside class="footnote brackets" id="f4" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id10">1</a>,<a role="doc-backlink" href="#id11">2</a>)</span>
<p>N.N. Elkin, A.P. Napartovich, in “Applied optics of Lasers”, Moscow TsniiAtomInform, 66 (1989) (in Russian).</p>
</aside>
<aside class="footnote brackets" id="f5" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></span>
<ol class="upperalpha simple" start="18">
<li><p>Bacarat, in “The Computer in Optical Research”, ed. B.R. Frieden, Springer Verlag, 72-75 (1980).</p></li>
</ol>
</aside>
<aside class="footnote brackets" id="f6" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></span>
<p>A.A. Samarskii, E.S. Nikolaev, Numerical Methods for Grid Equations, V.1, Direct methods, pp. 61-65, Birkhäuser Verlag (1989).</p>
</aside>
<aside class="footnote brackets" id="f7" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id13">7</a><span class="fn-bracket">]</span></span>
<ol class="upperalpha simple" start="13">
<li><p>Born, E. Wolf, Principles of Optics, Pergamon, 464, 767-772 (1993).</p></li>
</ol>
</aside>
<aside class="footnote brackets" id="f8" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id14">1</a>,<a role="doc-backlink" href="#id15">2</a>)</span>
<ol class="upperalpha simple" start="4">
<li><p>Malacara, Optical shop testing, J. Wiley &amp; Sons, (1992).</p></li>
</ol>
</aside>
</aside>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="UserDefinedFunctions.html" class="btn btn-neutral float-left" title="5. User defined functions." accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="examples.html" class="btn btn-neutral float-right" title="7. Examples." accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Fred van Goor.
      <span class="lastupdated">Last updated on Aug 15, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>